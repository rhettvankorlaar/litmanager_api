Ë
:E:\litmanager\litmanager-api\litmanager-api\ContextSeed.cs
	namespace

 	
API


 
{ 
public 

class 
ContextSeed 
{ 
private 
static 
Boolean 
? 
useInMemory  +
=, -
null. 2
;2 3
public 
static 
void 
Init 
(  
Boolean  '
_useInMemory( 4
=5 6
false7 <
)< =
{ 	
useInMemory 
= 
_useInMemory &
;& '
} 	
public 
static 
void 
	SeedAsync $
($ %
IServiceProvider% 5
services6 >
)> ?
{ 	
var 
_context 
= 
services #
.# $
GetRequiredService$ 6
<6 7
DataContext7 B
>B C
(C D
)D E
;E F
if 
( 
useInMemory 
== 
null #
)# $
{ 
throw 
new  
ApplicationException .
(. /
$str/ i
)i j
;j k
} 
if 
( 
! 
useInMemory 
. 
Value "
)" #
{ 
_context 
. 
Database !
.! "
Migrate" )
() *
)* +
;+ ,
}   
}!! 	
}"" 
}## ó!
EE:\litmanager\litmanager-api\litmanager-api\Contracts\V1\ApiRoutes.cs
	namespace 	
litmanager_api
 
. 
	Contracts "
." #
V1# %
{ 
public 

static 
class 
	ApiRoutes !
{		 
public

 
const

 
string

 
Root

  
=

! "
$str

# (
;

( )
public 
const 
string 
Version #
=$ %
$str& *
;* +
public 
const 
string 
Base  
=! "
Root# '
+( )
$str* -
+. /
Version0 7
;7 8
public 
static 
class 
Identity $
{ 	
public 
const 
string 
Login  %
=& '
Base( ,
+- .
$str/ @
;@ A
public 
const 
string 
Refresh  '
=( )
Base* .
+/ 0
$str1 D
;D E
} 	
public 
static 
class 
User  
{ 	
public 
const 
string 
GetAll  &
=' (
Base) -
+. /
$str0 8
;8 9
public 
const 
string 
Get  #
=$ %
Base& *
++ ,
$str- =
;= >
public 
const 
string 
Create  &
=' (
Base) -
+. /
$str0 7
;7 8
public 
const 
string 
Update  &
=' (
Base) -
+. /
$str0 @
;@ A
public 
const 
string 
Delete  &
=' (
Base) -
+. /
$str0 @
;@ A
public 
const 
string 
Patch  %
=& '
Base( ,
+- .
$str/ ?
;? @
} 	
public 
static 
class 
Registration (
{ 	
public   
const   
string   
GetAll    &
=  ' (
Base  ) -
+  . /
$str  0 @
;  @ A
public!! 
const!! 
string!! 
Get!!  #
=!!$ %
Base!!& *
+!!+ ,
$str!!- M
;!!M N
public"" 
const"" 
string"" 
Create""  &
=""' (
Base"") -
+"". /
$str""0 ?
;""? @
public## 
const## 
string## 
Update##  &
=##' (
Base##) -
+##. /
$str##0 P
;##P Q
public$$ 
const$$ 
string$$ 
Approve$$  '
=$$( )
Base$$* .
+$$/ 0
$str$$1 Y
;$$Y Z
public%% 
const%% 
string%% 
Deny%%  $
=%%% &
Base%%' +
+%%, -
$str%%. S
;%%S T
}&& 	
public(( 
static(( 
class(( 
UserType(( $
{)) 	
public** 
const** 
string** 
GetAll**  &
=**' (
Base**) -
+**. /
$str**0 <
;**< =
public++ 
const++ 
string++ 
Get++  #
=++$ %
Base++& *
++++ ,
$str++- E
;++E F
public,, 
const,, 
string,, 
Create,,  &
=,,' (
Base,,) -
+,,. /
$str,,0 ;
;,,; <
public-- 
const-- 
string-- 
Update--  &
=--' (
Base--) -
+--. /
$str--0 H
;--H I
public.. 
const.. 
string.. 
Delete..  &
=..' (
Base..) -
+... /
$str..0 H
;..H I
}// 	
}00 
}11 “
\E:\litmanager\litmanager-api\litmanager-api\Contracts\V1\Requests\Identity\RefreshRequest.cs
	namespace 	
litmanager_api
 
. 
	Contracts "
." #
V1# %
.% &
Requests& .
.. /
Identity/ 7
{ 
public 

class 
RefreshRequest 
{		 
public

 
string

 
Token

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
public 
string 
RefreshToken "
{# $
get% (
;( )
set* -
;- .
}/ 0
} 
}  
ZE:\litmanager\litmanager-api\litmanager-api\Contracts\V1\Requests\Identity\TokenRequest.cs
	namespace 	
litmanager_api
 
. 
	Contracts "
." #
V1# %
.% &
Requests& .
.. /
Identity/ 7
{ 
public 

class 
TokenRequest 
{		 
public

 
string

 
Email

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} ¯
_E:\litmanager\litmanager-api\litmanager-api\Contracts\V1\Requests\Registration\CreateRequest.cs
	namespace 	
litmanager_api
 
. 
	Contracts "
." #
V1# %
.% &
Requests& .
.. /
Registration/ ;
{		 
public

 

class

 
CreateRequest

 
{ 
[ 	
Required	 
( 
ErrorMessage 
=  
$str! :
): ;
]; <
public 
string 
Id 
{ 
get 
; 
set  #
;# $
}% &
[ 	
Required	 
( 
ErrorMessage 
=  
$str! 6
)6 7
]7 8
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
[ 	
Required	 
( 
ErrorMessage 
=  
$str! 9
)9 :
]: ;
public 
string 
	FirstName 
{  !
get" %
;% &
set' *
;* +
}, -
[ 	
Required	 
( 
ErrorMessage 
=  
$str! ;
); <
]< =
public 
string 
LastName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
DateTime 
DateOfBirth #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
Guid 

UserTypeId 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} Æ	
_E:\litmanager\litmanager-api\litmanager-api\Contracts\V1\Requests\Registration\UpdateRequest.cs
	namespace 	
litmanager_api
 
. 
	Contracts "
." #
V1# %
.% &
Requests& .
.. /
Registration/ ;
{		 
public

 

class

 
UpdateRequest

 
{ 
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
	FirstName 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
LastName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
DateTime 
DateOfBirth #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
Guid 

UserTypeId 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} Ø
[E:\litmanager\litmanager-api\litmanager-api\Contracts\V1\Requests\UserType\CreateRequest.cs
	namespace 	
litmanager_api
 
. 
	Contracts "
." #
V1# %
.% &
Requests& .
.. /
UserType/ 7
{		 
public

 

class

 
CreateRequest

 
{ 
public 
string 
Type 
{ 
get  
;  !
set" %
;% &
}' (
} 
} Ø
[E:\litmanager\litmanager-api\litmanager-api\Contracts\V1\Requests\UserType\UpdateRequest.cs
	namespace 	
litmanager_api
 
. 
	Contracts "
." #
V1# %
.% &
Requests& .
.. /
UserType/ 7
{		 
public

 

class

 
UpdateRequest

 
{ 
public 
string 
Type 
{ 
get  
;  !
set" %
;% &
}' (
} 
} Œ
WE:\litmanager\litmanager-api\litmanager-api\Contracts\V1\Requests\User\CreateRequest.cs
	namespace 	
litmanager_api
 
. 
	Contracts "
." #
V1# %
.% &
Requests& .
.. /
User/ 3
{		 
public

 

class

 
CreateRequest

 
{ 
[ 	
Required	 
( 
ErrorMessage 
=  
$str! 3
)3 4
]4 5
public 
string 
Id 
{ 
get 
; 
set  #
;# $
}% &
[ 	
Required	 
( 
ErrorMessage 
=  
$str! 6
)6 7
]7 8
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
	FirstName 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
LastName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
DateTime 
DateOfBirth #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
Guid 

UserTypeId 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} “
WE:\litmanager\litmanager-api\litmanager-api\Contracts\V1\Requests\User\UpdateRequest.cs
	namespace 	
litmanager_api
 
. 
	Contracts "
." #
V1# %
.% &
Requests& .
.. /
User/ 3
{ 
public		 

class		 
UpdateRequest		 
{

 
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
	FirstName 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
LastName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
DateTime 
DateOfBirth #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
Guid 

UserTypeId 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
bool 
	IsEnabled 
{ 
get  #
;# $
set% (
;( )
}* +
public 
bool 
IsAdmin 
{ 
get !
;! "
set# &
;& '
}( )
} 
} º
[E:\litmanager\litmanager-api\litmanager-api\Contracts\V1\Responses\Identity\AuthResponse.cs
	namespace 	
litmanager_api
 
. 
	Contracts "
." #
V1# %
.% &
	Responses& /
./ 0
Identity0 8
{ 
public 

class 
AuthResponse 
{		 
public

 
string

 
Token

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
public 
string 
RefreshToken "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
bool 
	IsSuccess 
{ 
get  #
;# $
set% (
;( )
}* +
public 
IEnumerable 
< 
string !
>! "
Errors# )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
} 
} “
\E:\litmanager\litmanager-api\litmanager-api\Contracts\V1\Responses\Identity\TokenResponse.cs
	namespace 	
litmanager_api
 
. 
	Contracts "
." #
V1# %
.% &
	Responses& /
./ 0
Identity0 8
{ 
public 

class 
TokenResponse 
{		 
public

 
string

 
Token

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
public 
string 
RefreshToken "
{# $
get% (
;( )
set* -
;- .
}/ 0
} 
} ü
^E:\litmanager\litmanager-api\litmanager-api\Contracts\V1\Responses\Registration\GetResponse.cs
	namespace 	
litmanager_api
 
. 
	Contracts "
." #
V1# %
.% &
	Responses& /
./ 0
Registration0 <
{ 
public 

class 
GetResponse 
{		 
public

 
string

 
Id

 
{

 
get

 
;

 
set

  #
;

# $
}

% &
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
	FirstName 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
LastName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
DateTime 
DateOfBirth #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
Guid 

UserTypeId 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
Domain 
. 
UserType 
UserType '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
public 
string 
FullName 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} ¡
ZE:\litmanager\litmanager-api\litmanager-api\Contracts\V1\Responses\UserType\GetResponse.cs
	namespace 	
litmanager_api
 
. 
	Contracts "
." #
V1# %
.% &
	Responses& /
./ 0
UserType0 8
{ 
public 

class 
GetResponse 
{		 
public

 
Guid

 
Id

 
{

 
get

 
;

 
set

 !
;

! "
}

# $
public 
string 
Type 
{ 
get  
;  !
set" %
;% &
}' (
} 
} ™
VE:\litmanager\litmanager-api\litmanager-api\Contracts\V1\Responses\User\GetResponse.cs
	namespace 	
litmanager_api
 
. 
	Contracts "
." #
V1# %
.% &
	Responses& /
./ 0
User0 4
{ 
public 

class 
GetResponse 
{		 
public

 
string

 
Id

 
{

 
get

 
;

 
set

  #
;

# $
}

% &
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
	FirstName 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
LastName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
DateTime 
DateOfBirth #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
Guid 

UserTypeId 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
Domain 
. 
UserType 
UserType '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
public 
bool 
	IsEnabled 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
FullName 
{  
get  #
;# $
set% (
;( )
}) *
} 
} ¨"
PE:\litmanager\litmanager-api\litmanager-api\Controllers\V1\IdentityController.cs
	namespace 	
litmanager_api
 
. 
Controllers $
.$ %
V1% '
{ 
public 

class 
IdentityController #
:$ %

Controller& 0
{ 
private 
readonly 
IdentityService (
_identityService) 9
;9 :
private 
readonly 
UserService $
_userService% 1
;1 2
public 
IdentityController !
(! "
IdentityService" 1
identityService2 A
,A B
UserServiceC N
userServiceO Z
)Z [
{ 	
_identityService 
= 
identityService .
;. /
_userService 
= 
userService &
;& '
} 	
[ 	
HttpPost	 
( 
	ApiRoutes 
. 
Identity $
.$ %
Login% *
)* +
]+ ,
public 
async 
Task 
< 
IActionResult '
>' (
Login) .
(. /
[/ 0
FromBody0 8
]8 9
TokenRequest9 E
requestF M
)M N
{ 	
var 
user 
= 
await 
_userService )
.) *
GetByEmailAsync* 9
(9 :
request: A
.A B
EmailB G
)G H
;H I
if 
( 
user 
== 
null 
) 
{ 
return 

BadRequest !
(! "
new" %
AuthResponse& 2
{   
	IsSuccess!! 
=!! 
false!!  %
,!!% &
Errors"" 
="" 
new""  
[""  !
]""! "
{""# $
$str""$ L
}""L M
}## 
)## 
;## 
}$$ 
var&& 
loginResult&& 
=&& 
await&& #
_identityService&&$ 4
.&&4 5

LoginAsync&&5 ?
(&&? @
user&&@ D
,&&D E
request&&F M
.&&M N
Password&&N V
)&&V W
;&&W X
if(( 
((( 
!(( 
loginResult(( 
.(( 
	IsSuccess(( &
)((& '
{)) 
return** 

BadRequest** !
(**! "
new**" %
AuthResponse**& 2
{++ 
	IsSuccess,, 
=,, 
false,,  %
,,,% &
Errors-- 
=-- 
loginResult-- (
.--( )
Errors--) /
}.. 
).. 
;.. 
}// 
return00 
Ok00 
(00 
loginResult00 !
)00! "
;00" #
}11 	
[33 	
HttpPost33	 
(33 
	ApiRoutes33 
.33 
Identity33 $
.33$ %
Refresh33% ,
)33, -
]33- .
public44 
async44 
Task44 
<44 
IActionResult44 '
>44' (
Refresh44) 0
(440 1
[441 2
FromBody442 :
]44: ;
RefreshRequest44; I
request44J Q
)44Q R
{55 	
var66 
refreshResult66 
=66 
await66  %
_identityService66& 6
.666 7
RefreshTokenAsync667 H
(66H I
request66I P
.66P Q
Token66Q V
,66V W
request66X _
.66_ `
RefreshToken66` l
)66l m
;66m n
if88 
(88 
!88 
refreshResult88 
.88 
	IsSuccess88 (
)88( )
{99 
return:: 

BadRequest:: !
(::! "
new::" %
AuthResponse::& 2
{;; 
Errors<< 
=<< 
refreshResult<< *
.<<* +
Errors<<+ 1
}== 
)== 
;== 
}>> 
return@@ 
Ok@@ 
(@@ 
refreshResult@@ #
)@@# $
;@@$ %
}AA 	
}BB 
}CC Èd
UE:\litmanager\litmanager-api\litmanager-api\Controllers\V1\RegistrationsController.cs
	namespace 	
litmanager_api
 
. 
Controllers $
.$ %
V1% '
{ 
public 

class #
RegistrationsController (
:) *

Controller+ 5
{ 
private 
readonly 
RegistrationService ,
_registeredService- ?
;? @
private 
readonly 
UserService $
_userService% 1
;1 2
private 
readonly 
IMapper  
_mapper! (
;( )
private 
readonly 
UserTypeService (
_userTypeService) 9
;9 :
private 
readonly 
IMailSender $
_mail% *
;* +
public #
RegistrationsController &
(& '
RegistrationService' :
registrationService; N
,N O
UserServiceP [
userService\ g
,g h
IMapperj q
mapperr x
,x y
UserTypeService	z â
userTypeService
ä ô
,
ô ö
IMailSender
õ ¶
mail
ß ´
)
´ ¨
{ 	
_registeredService 
=  
registrationService! 4
;4 5
_userService 
= 
userService &
;& '
_mapper 
= 
mapper 
; 
_userTypeService 
= 
userTypeService .
;. /
_mail   
=   
mail   
;   
}!! 	
[## 	
HttpPost##	 
(## 
	ApiRoutes## 
.## 
Registration## (
.##( )
Create##) /
)##/ 0
]##0 1
public$$ 
async$$ 
Task$$ 
<$$ 
IActionResult$$ '
>$$' (
CreateAsync$$) 4
($$4 5
[$$5 6
FromBody$$6 >
]$$> ?
CreateRequest$$? L
request$$M T
)$$T U
{%% 	
var'' 
type'' 
='' 
await'' 
_userTypeService'' -
.''- .
GetAsync''. 6
(''6 7
request''7 >
.''> ?

UserTypeId''? I
)''I J
;''J K
if(( 
((( 
type(( 
==(( 
null(( 
)(( 
{)) 
return** 

BadRequest** !
(**! "
)**" #
;**# $
}++ 
if-- 
(-- 
await-- 
_userService-- !
.--! "

UserExists--" ,
(--, -
request--- 4
.--4 5
Id--5 7
,--7 8
request--8 ?
.--? @
Email--@ E
)--E F
)--F G
{.. 
return// 

BadRequest// !
(//! "
)//" #
;//# $
}00 
var33 
result33 
=33 
await33 
_registeredService33 1
.331 2
AddAsync332 :
(33: ;
request33; B
)33B C
;33C D
if44 
(44 
!44 
result44 
)44 
{55 
return66 

BadRequest66 !
(66! "
)66" #
;66# $
}77 
var99 
baseUrl99 
=99 
$"99 
{99 
HttpContext99 (
.99( )
Request99) 0
.990 1
Scheme991 7
}997 8
://998 ;
{99; <
HttpContext99< G
.99G H
Request99H O
.99O P
Host99P T
.99T U
ToUriComponent99U c
(99c d
)99d e
}99e f
"99f g
;99g h
var:: 
locationUri:: 
=:: 
baseUrl:: %
+::& '
$str::( +
+::, -
	ApiRoutes::. 7
.::7 8
Registration::8 D
.::D E
Get::E H
.::H I
Replace::I P
(::P Q
$str::Q c
,::c d
request::e l
.::l m
Id::m o
)::o p
;::p q
var;; 
registration;; 
=;; 
_mapper;; &
.;;& '
Map;;' *
<;;* +
GetResponse;;+ 6
>;;6 7
(;;7 8
request;;8 ?
);;? @
;;;@ A
var== 
receiver== 
=== 
new== 
Receiver== '
{>> 
Email?? 
=?? 
registration?? $
.??$ %
Email??% *
,??* +
	FirstName@@ 
=@@ 
registration@@ (
.@@( )
	FirstName@@) 2
,@@2 3
LastNameAA 
=AA 
registrationAA '
.AA' (
LastNameAA( 0
}BB 
;BB 
SendMailFF 
(FF 
receiverFF 
,FF 
$strFF +
,FF+ ,
$strFF- 6
)FF6 7
;FF7 8
returnHH 
CreatedHH 
(HH 
locationUriHH &
,HH& '
registrationHH( 4
)HH4 5
;HH5 6
}II 	
[KK 	
HttpGetKK	 
(KK 
	ApiRoutesKK 
.KK 
RegistrationKK '
.KK' (
GetKK( +
)KK+ ,
]KK, -
publicLL 
asyncLL 
TaskLL 
<LL 
IActionResultLL '
>LL' (
GetAsyncLL) 1
(LL1 2
[LL2 3
	FromRouteLL3 <
]LL< =
stringLL= C
registrationIdLLD R
)LLR S
{MM 	
varOO 
resultOO 
=OO 
awaitOO 
_registeredServiceOO 1
.OO1 2
GetAsyncOO2 :
(OO: ;
registrationIdOO; I
)OOI J
;OOJ K
ifPP 
(PP 
resultPP 
==PP 
nullPP 
)PP 
{QQ 
returnRR 
NotFoundRR 
(RR  
)RR  !
;RR! "
}SS 
returnUU 
OkUU 
(UU 
_mapperUU 
.UU 
MapUU !
<UU! "
GetResponseUU" -
>UU- .
(UU. /
resultUU/ 5
)UU5 6
)UU6 7
;UU7 8
}VV 	
[XX 	
HttpGetXX	 
(XX 
	ApiRoutesXX 
.XX 
RegistrationXX '
.XX' (
GetAllXX( .
)XX. /
]XX/ 0
publicYY 
asyncYY 
TaskYY 
<YY 
IActionResultYY '
>YY' (
GetAllAsyncYY) 4
(YY4 5
)YY5 6
{ZZ 	
var\\ 
result\\ 
=\\ 
await\\ 
_registeredService\\ 1
.\\1 2
GetAllAsync\\2 =
(\\= >
)\\> ?
;\\? @
if]] 
(]] 
result]] 
==]] 
null]] 
)]] 
{^^ 
return__ 
NotFound__ 
(__  
)__  !
;__! "
}`` 
returnbb 
Okbb 
(bb 
_mapperbb 
.bb 
Mapbb !
<bb! "
Listbb" &
<bb& '
GetResponsebb' 2
>bb2 3
>bb3 4
(bb4 5
resultbb5 ;
)bb; <
)bb< =
;bb= >
}cc 	
[ee 	
HttpPutee	 
(ee 
	ApiRoutesee 
.ee 
Registrationee '
.ee' (
Updateee( .
)ee. /
]ee/ 0
publicff 
asyncff 
Taskff 
<ff 
IActionResultff '
>ff' (
UpdateAsyncff) 4
(ff4 5
[ff5 6
	FromRouteff6 ?
]ff? @
stringff@ F
registrationIdffG U
,ffU V
[ffW X
FromBodyffX `
]ff` a
UpdateRequestffa n
requestffo v
)ffv w
{gg 	
varii 
registrationii 
=ii 
_mapperii &
.ii& '
Mapii' *
<ii* +
Registrationii+ 7
>ii7 8
(ii8 9
requestii9 @
)ii@ A
;iiA B
varll 
resultll 
=ll 
awaitll 
_registeredServicell 1
.ll1 2
UpdateAsyncll2 =
(ll= >
registrationll> J
)llJ K
;llK L
ifmm 
(mm 
!mm 
resultmm 
)mm 
{nn 
returnoo 
NotFoundoo 
(oo  
)oo  !
;oo! "
}pp 
returnrr 
awaitrr 
GetAsyncrr !
(rr! "
registrationIdrr" 0
)rr0 1
;rr1 2
}ss 	
[vv 	
HttpGetvv	 
(vv 
	ApiRoutesvv 
.vv 
Registrationvv '
.vv' (
Approvevv( /
)vv/ 0
]vv0 1
publicww 
asyncww 
Taskww 
<ww 
IActionResultww '
>ww' (
ApproveAsyncww) 5
(ww5 6
[ww6 7
	FromRouteww7 @
]ww@ A
stringwwA G
registrationIdwwH V
)wwV W
{xx 	
varzz 
registrationzz 
=zz 
awaitzz $
_registeredServicezz% 7
.zz7 8
GetAsynczz8 @
(zz@ A
registrationIdzzA O
)zzO P
;zzP Q
var}} 
user}} 
=}} 
_mapper}} 
.}} 
Map}} "
<}}" #
User}}# '
>}}' (
(}}( )
registration}}) 5
)}}5 6
;}}6 7
var
ÄÄ 
result
ÄÄ 
=
ÄÄ 
await
ÄÄ 
_userService
ÄÄ +
.
ÄÄ+ ,
AddAsync
ÄÄ, 4
(
ÄÄ4 5
user
ÄÄ5 9
)
ÄÄ9 :
;
ÄÄ: ;
if
ÇÇ 
(
ÇÇ 
!
ÇÇ 
result
ÇÇ 
)
ÇÇ 
{
ÉÉ 
return
ÑÑ 

BadRequest
ÑÑ !
(
ÑÑ! "
)
ÑÑ" #
;
ÑÑ# $
}
ÖÖ 
await
áá 
	DenyAsync
áá 
(
áá 
registrationId
áá *
)
áá* +
;
áá+ ,
var
ää 
receiver
ää 
=
ää 
new
ää 
Receiver
ää '
{
ãã 
Email
åå 
=
åå 
user
åå 
.
åå 
Email
åå #
,
åå# $
	FirstName
çç 
=
çç 
user
çç !
.
çç! "
	FirstName
çç" +
,
çç+ ,
LastName
éé 
=
éé 
user
éé  
.
éé  !
LastName
éé! )
}
èè 
;
èè 
SendMail
ìì 
(
ìì 
receiver
ìì 
,
ìì 
$str
ìì (
,
ìì( )
$str
ìì) 2
)
ìì2 3
;
ìì3 4
return
ïï 
Ok
ïï 
(
ïï 
)
ïï 
;
ïï 
}
óó 	
[
ôô 	
HttpGet
ôô	 
(
ôô 
	ApiRoutes
ôô 
.
ôô 
Registration
ôô '
.
ôô' (
Deny
ôô( ,
)
ôô, -
]
ôô- .
public
öö 
async
öö 
Task
öö 
<
öö 
IActionResult
öö '
>
öö' (
	DenyAsync
öö) 2
(
öö2 3
[
öö3 4
	FromRoute
öö4 =
]
öö= >
string
öö> D
registrationId
ööE S
)
ööS T
{
õõ 	
var
ùù 
result
ùù 
=
ùù 
await
ùù  
_registeredService
ùù 1
.
ùù1 2
DeleteAsync
ùù2 =
(
ùù= >
registrationId
ùù> L
)
ùùL M
;
ùùM N
if
ûû 
(
ûû 
!
ûû 
result
ûû 
)
ûû 
{
üü 
return
†† 
NotFound
†† 
(
††  
)
††  !
;
††! "
}
°° 
return
££ 
Ok
££ 
(
££ 
)
££ 
;
££ 
}
§§ 	
private
¶¶ 
void
¶¶ 
SendMail
¶¶ 
(
¶¶ 
Receiver
¶¶ &
receiver
¶¶' /
,
¶¶/ 0
string
¶¶1 7
subject
¶¶8 ?
,
¶¶? @
string
¶¶A G
content
¶¶H O
)
¶¶O P
{
ßß 	
try
®® 
{
©© 
_mail
™™ 
.
™™ 
SendMail
™™ 
(
™™ 
receiver
™™ '
,
™™' (
subject
™™) 0
,
™™0 1
content
™™1 8
)
™™8 9
;
™™9 :
}
´´ 
catch
¨¨ 
{
≠≠ 
}
ØØ 
}
±± 	
}
≤≤ 
}≥≥ ÉU
LE:\litmanager\litmanager-api\litmanager-api\Controllers\V1\UserController.cs
	namespace 	
litmanager_api
 
. 
Controllers $
.$ %
V1% '
{ 
public 

class 
UserController 
:  !

Controller" ,
{ 
private 
readonly 
UserService $
_userService% 1
;1 2
private 
readonly 
IMapper  
_mapper! (
;( )
private 
readonly 
UserTypeService (
_userTypeService) 9
;9 :
private 
readonly 
IMailSender $
_mail% *
;* +
public 
UserController 
( 
UserService )
userService* 5
,5 6
IMapper7 >
mapper? E
,E F
UserTypeServiceG V
userTypeServiceW f
,f g
IMailSenderh s
mailt x
)x y
{ 	
_userService 
= 
userService &
;& '
_mapper 
= 
mapper 
; 
_userTypeService 
= 
userTypeService .
;. /
_mail 
= 
mail 
; 
} 	
[   	
HttpPost  	 
(   
	ApiRoutes   
.   
User    
.    !
Create  ! '
)  ' (
]  ( )
public!! 
async!! 
Task!! 
<!! 
IActionResult!! '
>!!' (
CreateAsync!!) 4
(!!4 5
[!!5 6
FromBody!!6 >
]!!> ?
CreateRequest!!? L
request!!M T
)!!T U
{"" 	
var$$ 
user$$ 
=$$ 
_mapper$$ 
.$$ 
Map$$ "
<$$" #
User$$# '
>$$' (
($$( )
request$$) 0
)$$0 1
;$$1 2
user'' 
.'' 
Email'' 
='' 
user'' 
.'' 
Email'' #
.''# $
ToUpper''$ +
(''+ ,
)'', -
;''- .
user** 
.** 
	IsEnabled** 
=** 
true** !
;**! "
var++ 
result++ 
=++ 
await++ 
_userService++ +
.+++ ,
AddAsync++, 4
(++4 5
user++5 9
)++9 :
;++: ;
if,, 
(,, 
!,, 
result,, 
),, 
{-- 
return.. 
	NoContent..  
(..  !
)..! "
;.." #
}// 
var11 
baseUrl11 
=11 
$"11 
{11 
HttpContext11 (
.11( )
Request11) 0
.110 1
Scheme111 7
}117 8
://118 ;
{11; <
HttpContext11< G
.11G H
Request11H O
.11O P
Host11P T
.11T U
ToUriComponent11U c
(11c d
)11d e
}11e f
"11f g
;11g h
var22 
locationUri22 
=22 
baseUrl22 %
+22& '
$str22( +
+22, -
	ApiRoutes22. 7
.227 8
User228 <
.22< =
Get22= @
.22@ A
Replace22A H
(22H I
$str22I S
,22S T
request22U \
.22\ ]
Id22] _
)22_ `
;22` a
return33 
Created33 
(33 
locationUri33 &
,33& '
_mapper33( /
.33/ 0
Map330 3
<333 4
GetResponse334 ?
>33? @
(33@ A
request33A H
)33H I
)33I J
;33J K
}44 	
[66 	
HttpGet66	 
(66 
	ApiRoutes66 
.66 
User66 
.66  
Get66  #
)66# $
]66$ %
public77 
async77 
Task77 
<77 
IActionResult77 '
>77' (
GetAsync77) 1
(771 2
[772 3
	FromRoute773 <
]77< =
string77= C
userId77D J
)77J K
{88 	
var:: 
result:: 
=:: 
await:: 
_userService:: +
.::+ ,
GetAsync::, 4
(::4 5
userId::5 ;
)::; <
;::< =
if;; 
(;; 
result;; 
==;; 
null;; 
);; 
{<< 
return== 
NotFound== 
(==  
)==  !
;==! "
}>> 
return@@ 
Ok@@ 
(@@ 
_mapper@@ 
.@@ 
Map@@ !
<@@! "
GetResponse@@" -
>@@- .
(@@. /
result@@/ 5
)@@5 6
)@@6 7
;@@7 8
}AA 	
[CC 	
HttpGetCC	 
(CC 
	ApiRoutesCC 
.CC 
UserCC 
.CC  
GetAllCC  &
)CC& '
]CC' (
publicDD 
asyncDD 
TaskDD 
<DD 
IActionResultDD '
>DD' (
GetAllAsyncDD) 4
(DD4 5
)DD5 6
{EE 	
varGG 
resultGG 
=GG 
awaitGG 
_userServiceGG +
.GG+ ,
GetAllAsyncGG, 7
(GG7 8
)GG8 9
;GG9 :
ifHH 
(HH 
resultHH 
==HH 
nullHH 
)HH 
{II 
returnJJ 
NotFoundJJ 
(JJ  
)JJ  !
;JJ! "
}KK 
varMM 
xMM 
=MM 
_mapperMM 
.MM 
MapMM 
<MM  
ListMM  $
<MM$ %
GetResponseMM% 0
>MM0 1
>MM1 2
(MM2 3
resultMM3 9
)MM9 :
;MM: ;
returnNN 
OkNN 
(NN 
xNN 
)NN 
;NN 
}OO 	
[QQ 	
HttpPutQQ	 
(QQ 
	ApiRoutesQQ 
.QQ 
UserQQ 
.QQ  
UpdateQQ  &
)QQ& '
]QQ' (
publicRR 
asyncRR 
TaskRR 
<RR 
IActionResultRR '
>RR' (
UpdateAsyncRR) 4
(RR4 5
[RR5 6
	FromRouteRR6 ?
]RR? @
stringRR@ F
userIdRRG M
,RRM N
[RRO P
FromBodyRRP X
]RRX Y
UpdateRequestRRY f
requestRRg n
)RRn o
{SS 	
varUU 
userUU 
=UU 
_mapperUU 
.UU 
MapUU "
<UU" #
UserUU# '
>UU' (
(UU( )
requestUU) 0
)UU0 1
;UU1 2
varXX 
resultXX 
=XX 
awaitXX 
_userServiceXX +
.XX+ ,
UpdateAsyncXX, 7
(XX7 8
userXX8 <
)XX< =
;XX= >
ifYY 
(YY 
!YY 
resultYY 
)YY 
{ZZ 
return[[ 
NotFound[[ 
([[  
)[[  !
;[[! "
}\\ 
return^^ 
await^^ 
GetAsync^^ !
(^^! "
userId^^" (
)^^( )
;^^) *
}__ 	
[aa 	

HttpDeleteaa	 
(aa 
	ApiRoutesaa 
.aa 
Useraa "
.aa" #
Deleteaa# )
)aa) *
]aa* +
publicbb 
asyncbb 
Taskbb 
<bb 
IActionResultbb '
>bb' (
DeleteAsyncbb) 4
(bb4 5
[bb5 6
	FromRoutebb6 ?
]bb? @
stringbb@ F
userIdbbG M
)bbM N
{cc 	
varee 
resultee 
=ee 
awaitee 
_userServiceee +
.ee+ ,
DeleteAsyncee, 7
(ee7 8
userIdee8 >
)ee> ?
;ee? @
ifff 
(ff 
!ff 
resultff 
)ff 
{gg 
returnhh 
NotFoundhh 
(hh  
)hh  !
;hh! "
}ii 
returnkk 
Okkk 
(kk 
)kk 
;kk 
}ll 	
[nn 	
	HttpPatchnn	 
(nn 
	ApiRoutesnn 
.nn 
Usernn !
.nn! "
Patchnn" '
)nn' (
]nn( )
publicoo 
asyncoo 
Taskoo 
<oo 
IActionResultoo '
>oo' (
	PatchUseroo) 2
(oo2 3
[oo3 4
	FromRouteoo4 =
]oo= >
stringoo> D
userIdooE K
,ooK L
[ooM N
FromBodyooN V
]ooV W
JsonPatchDocumentooW h
<ooh i
Userooi m
>oom n
patchooo t
)oot u
{pp 	
varqq 
userqq 
=qq 
awaitqq 
_userServiceqq )
.qq) *
GetAsyncqq* 2
(qq2 3
userIdqq3 9
)qq9 :
;qq: ;
patchrr 
.rr 
ApplyTorr 
(rr 
userrr 
,rr 

ModelStaterr  *
)rr* +
;rr+ ,
vartt 
updatedtt 
=tt 
awaittt 
_userServicett  ,
.tt, -
UpdateAsynctt- 8
(tt8 9
usertt9 =
)tt= >
;tt> ?
ifvv 
(vv 
!vv 
updatedvv 
)vv 
{ww 
returnxx 
NotFoundxx 
(xx  
)xx  !
;xx! "
}yy 
returnzz 
Okzz 
(zz 
)zz 
;zz 
}{{ 	
private}} 
void}} 
HandleEmailChange}} &
(}}& '
User}}' +
user}}, 0
)}}0 1
{~~ 	
var 
receiver 
= 
new 
Receiver '
{
ÄÄ 
Email
ÅÅ 
=
ÅÅ 
user
ÅÅ 
.
ÅÅ 
Email
ÅÅ "
,
ÅÅ" #
	FirstName
ÇÇ 
=
ÇÇ 
user
ÇÇ  
.
ÇÇ  !
	FirstName
ÇÇ! *
,
ÇÇ* +
LastName
ÉÉ 
=
ÉÉ 
user
ÉÉ 
.
ÉÉ  
LastName
ÉÉ  (
}
ÑÑ 
;
ÑÑ 
try
ÜÜ 
{
áá 
_mail
àà 
.
àà 
SendMail
àà 
(
àà 
receiver
àà '
,
àà' (
$str
àà) 8
,
àà8 9
$str
àà: C
)
ààC D
;
ààD E
}
ââ 
catch
ää 
{
ãã 
}
çç 
}
éé 	
}
êê 
}ññ =
PE:\litmanager\litmanager-api\litmanager-api\Controllers\V1\UserTypeController.cs
	namespace 	
litmanager_api
 
. 
Controllers $
.$ %
V1% '
{ 
public 

class 
UserTypeController #
:$ %

Controller& 0
{ 
private 
readonly 
UserTypeService (
_userTypeService) 9
;9 :
private 
readonly 
IMapper  
_mapper! (
;( )
public 
UserTypeController !
(! "
UserTypeService" 1
userTypeService2 A
,A B
IMapperC J
mapperK Q
)Q R
{ 	
_userTypeService 
= 
userTypeService .
;. /
_mapper 
= 
mapper 
; 
} 	
[ 	
HttpPost	 
( 
	ApiRoutes 
. 
UserType $
.$ %
Create% +
)+ ,
], -
public 
async 
Task 
< 
IActionResult '
>' (
CreateAsync) 4
(4 5
[5 6
FromBody6 >
]> ?
CreateRequest? L
requestM T
)T U
{ 	
var 
userType 
= 
_mapper "
." #
Map# &
<& '
UserType' /
>/ 0
(0 1
request1 8
)8 9
;9 :
userType 
. 
Id 
= 
Guid 
. 
NewGuid &
(& '
)' (
;( )
var"" 
result"" 
="" 
await"" 
_userTypeService"" /
.""/ 0
AddAsync""0 8
(""8 9
userType""9 A
)""A B
;""B C
if## 
(## 
!## 
result## 
)## 
{$$ 
return%% 
	NoContent%%  
(%%  !
)%%! "
;%%" #
}&& 
var(( 
baseUrl(( 
=(( 
$"(( 
{(( 
HttpContext(( (
.((( )
Request(() 0
.((0 1
Scheme((1 7
}((7 8
://((8 ;
{((; <
HttpContext((< G
.((G H
Request((H O
.((O P
Host((P T
.((T U
ToUriComponent((U c
(((c d
)((d e
}((e f
"((f g
;((g h
var)) 
locationUri)) 
=)) 
baseUrl)) %
+))& '
$str))( +
+)), -
	ApiRoutes)). 7
.))7 8
UserType))8 @
.))@ A
Get))A D
.))D E
Replace))E L
())L M
$str))M [
,))[ \
userType))] e
.))e f
Id))f h
.))h i
ToString))i q
())q r
)))r s
)))s t
;))t u
return** 
Created** 
(** 
locationUri** &
,**& '
_mapper**( /
.**/ 0
Map**0 3
<**3 4
GetResponse**4 ?
>**? @
(**@ A
userType**A I
)**I J
)**J K
;**K L
}++ 	
[-- 	
HttpGet--	 
(-- 
	ApiRoutes-- 
.-- 
UserType-- #
.--# $
Get--$ '
)--' (
]--( )
public.. 
async.. 
Task.. 
<.. 
IActionResult.. '
>..' (
GetAsync..) 1
(..1 2
[..2 3
	FromRoute..3 <
]..< =
Guid..= A

userTypeId..B L
)..L M
{// 	
var11 
result11 
=11 
await11 
_userTypeService11 /
.11/ 0
GetAsync110 8
(118 9

userTypeId119 C
)11C D
;11D E
if22 
(22 
result22 
==22 
null22 
)22 
{33 
return44 
NotFound44 
(44  
)44  !
;44! "
}55 
return77 
Ok77 
(77 
_mapper77 
.77 
Map77 !
<77! "
GetResponse77" -
>77- .
(77. /
result77/ 5
)775 6
)776 7
;777 8
}88 	
[:: 	
HttpGet::	 
(:: 
	ApiRoutes:: 
.:: 
UserType:: #
.::# $
GetAll::$ *
)::* +
]::+ ,
public;; 
async;; 
Task;; 
<;; 
IActionResult;; '
>;;' (
GetAllAsync;;) 4
(;;4 5
);;5 6
{<< 	
var>> 
result>> 
=>> 
await>> 
_userTypeService>> /
.>>/ 0
GetAllAsync>>0 ;
(>>; <
)>>< =
;>>= >
if?? 
(?? 
result?? 
==?? 
null?? 
)?? 
{@@ 
returnAA 
NotFoundAA 
(AA  
)AA  !
;AA! "
}BB 
returnDD 
OkDD 
(DD 
_mapperDD 
.DD 
MapDD !
<DD! "
ListDD" &
<DD& '
GetResponseDD' 2
>DD2 3
>DD3 4
(DD4 5
resultDD5 ;
)DD; <
)DD< =
;DD= >
}EE 	
[GG 	
HttpPutGG	 
(GG 
	ApiRoutesGG 
.GG 
UserTypeGG #
.GG# $
UpdateGG$ *
)GG* +
]GG+ ,
publicHH 
asyncHH 
TaskHH 
<HH 
IActionResultHH '
>HH' (
UpdateAsyncHH) 4
(HH4 5
[HH5 6
	FromRouteHH6 ?
]HH? @
GuidHH@ D

userTypeIdHHE O
,HHO P
[HHQ R
FromBodyHHR Z
]HHZ [
UpdateRequestHH[ h
requestHHi p
)HHp q
{II 	
varKK 
userTypeKK 
=KK 
_mapperKK "
.KK" #
MapKK# &
<KK& '
UserTypeKK' /
>KK/ 0
(KK0 1
requestKK1 8
)KK8 9
;KK9 :
varNN 
resultNN 
=NN 
awaitNN 
_userTypeServiceNN /
.NN/ 0
UpdateAsyncNN0 ;
(NN; <
userTypeNN< D
)NND E
;NNE F
ifOO 
(OO 
!OO 
resultOO 
)OO 
{PP 
returnQQ 
NotFoundQQ 
(QQ  
)QQ  !
;QQ! "
}RR 
returnTT 
awaitTT 
GetAsyncTT !
(TT! "

userTypeIdTT" ,
)TT, -
;TT- .
}UU 	
[WW 	

HttpDeleteWW	 
(WW 
	ApiRoutesWW 
.WW 
UserTypeWW &
.WW& '
DeleteWW' -
)WW- .
]WW. /
publicXX 
asyncXX 
TaskXX 
<XX 
IActionResultXX '
>XX' (
DeleteAsyncXX) 4
(XX4 5
[XX5 6
	FromRouteXX6 ?
]XX? @
GuidXX@ D

userTypeIdXXE O
)XXO P
{YY 	
var[[ 
result[[ 
=[[ 
await[[ 
_userTypeService[[ /
.[[/ 0
DeleteAsync[[0 ;
([[; <

userTypeId[[< F
)[[F G
;[[G H
if\\ 
(\\ 
!\\ 
result\\ 
)\\ 
{]] 
return^^ 
NotFound^^ 
(^^  
)^^  !
;^^! "
}__ 
returnaa 
Okaa 
(aa 
)aa 
;aa 
}bb 	
}cc 
}dd ﬂ
:E:\litmanager\litmanager-api\litmanager-api\DataContext.cs
	namespace 	
litmanager_api
 
{		 
public

 

class

 
DataContext

 
:

 
	DbContext

 (
{ 
public 
DbSet 
< 
Activity 
> 

Activities )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
public 
DbSet 
< 
ActivityType !
>! "
ActivityTypes# 0
{1 2
get3 6
;6 7
set8 ;
;; <
}= >
public 
DbSet 
< 
RefreshToken !
>! "
RefreshTokens# 0
{1 2
get3 6
;6 7
set8 ;
;; <
}= >
public 
DbSet 
< 
Registration !
>! "
Registrations# 0
{1 2
get3 6
;6 7
set8 ;
;; <
}= >
public 
DbSet 
< 
User 
> 
Users  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
DbSet 
< 
UserType 
> 
	UserTypes (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 
DataContext 
( 
) 
{ 	
} 	
public 
DataContext 
( 
DbContextOptions +
<+ ,
DataContext, 7
>7 8
option9 ?
)? @
:A B
baseC G
(G H
optionH N
)N O
{ 	
} 	
	protected 
override 
void 
OnModelCreating  /
(/ 0
ModelBuilder0 <
modelBuilder= I
)I J
{ 	
modelBuilder 
. 
Entity 
<  
UserActivity  ,
>, -
(- .
). /
. 
HasKey 
( 
ua 
=> 
new !
{" #
ua$ &
.& '
UserId' -
,- .
ua/ 1
.1 2

ActivityId2 <
}= >
)> ?
;? @
modelBuilder 
. 
Entity 
<  
UserActivity  ,
>, -
(- .
). /
.   
HasOne   
(   
ua   
=>   
ua    
.    !
User  ! %
)  % &
.!! 
WithMany!! 
(!! 
u!! 
=>!! 
u!!  
.!!  !
UserActivities!!! /
)!!/ 0
."" 
HasForeignKey"" 
("" 
ua"" !
=>""" $
ua""% '
.""' (
UserId""( .
)"". /
;""/ 0
modelBuilder## 
.## 
Entity## 
<##  
UserActivity##  ,
>##, -
(##- .
)##. /
.$$ 
HasOne$$ 
($$ 
ua$$ 
=>$$ 
ua$$  
.$$  !
Activity$$! )
)$$) *
.%% 
WithMany%% 
(%% 
a%% 
=>%% 
a%%  
.%%  !
UserActivities%%! /
)%%/ 0
.&& 
HasForeignKey&& 
(&& 
ua&& !
=>&&" $
ua&&% '
.&&' (

ActivityId&&( 2
)&&2 3
;&&3 4
}'' 	
}(( 
})) ª
>E:\litmanager\litmanager-api\litmanager-api\Domain\Activity.cs
	namespace 	
litmanager_api
 
. 
Domain 
{ 
public		 

class		 
Activity		 
{

 
[ 	
Key	 
] 
public 
Guid 
Id 
{ 
get 
; 
set !
;! "
}# $
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
DateTime 
Date 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
Description !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
ActivityType 
ActivityType (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 
int 
MaxUsers 
{ 
get !
;! "
set# &
;& '
}( )
public 
ICollection 
< 
UserActivity '
>' (
UserActivities) 7
{8 9
get: =
;= >
set? B
;B C
}D E
} 
} Ï
BE:\litmanager\litmanager-api\litmanager-api\Domain\ActivityType.cs
	namespace 	
litmanager_api
 
. 
Domain 
{ 
public		 

class		 
ActivityType		 
{

 
[ 	
Key	 
] 
public 
Guid 
Id 
{ 
get 
; 
set !
;! "
}# $
public 
string 
Type 
{ 
get  
;  !
set" %
;% &
}' (
} 
} ¿
BE:\litmanager\litmanager-api\litmanager-api\Domain\RefreshToken.cs
	namespace 	
litmanager_api
 
. 
Domain 
{		 
public

 

class

 
RefreshToken

 
{ 
[ 	
Key	 
] 
[ 	
DatabaseGenerated	 
( #
DatabaseGeneratedOption 2
.2 3
Identity3 ;
); <
]< =
public 
string 
Token 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
JwtId 
{ 
get !
;! "
set# &
;& '
}( )
public 
DateTime 
CreationDate $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 
DateTime 

ExpiryDate "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
bool 
Invalidated 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
UserId 
{ 
get "
;" #
set$ '
;' (
}) *
[ 	

ForeignKey	 
( 
nameof 
( 
UserId !
)! "
)" #
]# $
public 
User 
User 
{ 
get 
; 
set  #
;# $
}% &
} 
} ¨
BE:\litmanager\litmanager-api\litmanager-api\Domain\Registration.cs
	namespace 	
litmanager_api
 
. 
Domain 
{		 
public

 

class

 
Registration

 
{ 
[ 	
Key	 
] 
public 
string 
Id 
{ 
get 
; 
set  #
;# $
}% &
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
	FirstName 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
LastName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
DateTime 
DateOfBirth #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
Guid 

UserTypeId 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 	

ForeignKey	 
( 
nameof 
( 

UserTypeId %
)% &
)& '
]' (
public 
UserType 
UserType  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
string 
FullName 
{ 	
get 
{ 
return 
	FirstName  
+! "
$str# &
+' (
LastName) 1
;1 2
} 
} 	
} 
} „
:E:\litmanager\litmanager-api\litmanager-api\Domain\User.cs
	namespace 	
litmanager_api
 
. 
Domain 
{		 
public

 

class

 
User

 
{ 
[ 	
Key	 
] 
public 
string 
Id 
{ 
get 
; 
set  #
;# $
}% &
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
public 
string 
	FirstName 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
LastName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
PasswordHash "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
bool 
	IsEnabled 
{ 
get  #
;# $
set% (
;( )
}* +
public 
bool 
IsAdmin 
{ 
get !
;! "
set# &
;& '
}( )
public 
Guid 

UserTypeId 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 	

ForeignKey	 
( 
nameof 
( 

UserTypeId %
)% &
)& '
]' (
public 
UserType 
UserType  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
ICollection 
< 
UserActivity '
>' (
UserActivities) 7
{8 9
get: =
;= >
set? B
;B C
}D E
[ 	
	NotMapped	 
] 
public 
string 
FullName 
{  
get! $
{ 
return 
	FirstName  
+! "
$str# &
+' (
LastName) 1
;1 2
} 
} 	
} 
}   ˚
BE:\litmanager\litmanager-api\litmanager-api\Domain\UserActivity.cs
	namespace 	
litmanager_api
 
. 
Domain 
{ 
public 

class 
UserActivity 
{		 
public

 
string

 
UserId

 
{

 
get

 "
;

" #
set

$ '
;

' (
}

) *
public 
User 
User 
{ 
get 
; 
set  #
;# $
}% &
public 
Guid 

ActivityId 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
Activity 
Activity  
{! "
get# &
;& '
set( +
;+ ,
}- .
} 
} ‰
>E:\litmanager\litmanager-api\litmanager-api\Domain\UserType.cs
	namespace 	
litmanager_api
 
. 
Domain 
{ 
public		 

class		 
UserType		 
{

 
[ 	
Key	 
] 
public 
Guid 
Id 
{ 
get 
; 
set !
;! "
}# $
public 
string 
Type 
{ 
get  
;  !
set" %
;% &
}' (
} 
} ®
EE:\litmanager\litmanager-api\litmanager-api\Installers\DbInstaller.cs
	namespace

 	
litmanager_api


 
.

 

Installers

 #
{ 
public 

class 
DbInstaller 
: 

IInstaller )
{ 
public 
void 
InstallServices #
(# $
IServiceCollection$ 6
services7 ?
,? @
IConfigurationA O
ConfigurationP ]
)] ^
{ 	
services 
. 
AddCors 
( 
o 
=> !
o" #
.# $
	AddPolicy$ -
(- .
$str. 8
,8 9
builder: A
=>B D
{ 
builder 
. 
AllowAnyOrigin &
(& '
)' (
. 
AllowAnyMethod &
(& '
)' (
. 
AllowAnyHeader &
(& '
)' (
;( )
} 
) 
) 
; 
services 
. 
AddDbContext !
<! "
DataContext" -
>- .
(. /
options/ 6
=>7 9
{ 
ContextSeed 
. 
Init  
(  !
)! "
;" #
options 
. 
UseSqlServer $
($ %
Configuration% 2
.2 3
GetConnectionString3 F
(F G
$strG Z
)Z [
)[ \
;\ ]
} 
) 
; 
} 	
} 
} Ò
DE:\litmanager\litmanager-api\litmanager-api\Installers\IInstaller.cs
	namespace 	
litmanager_api
 
. 

Installers #
{ 
public 

	interface 

IInstaller 
{ 
void 
InstallServices 
( 
IServiceCollection /
services0 8
,8 9
IConfiguration: H
ConfigurationI V
)V W
;W X
}		 
}

 €
ME:\litmanager\litmanager-api\litmanager-api\Installers\InstallerExtensions.cs
	namespace		 	
litmanager_api		
 
.		 

Installers		 #
{

 
public 

static 
class 
InstallerExtensions +
{ 
public 
static 
void %
InstallServicesInAssembly 4
(4 5
this5 9
IServiceCollection: L
servicesM U
,U V
IConfigurationW e
configurationf s
)s t
{ 	
var 

installers 
= 
typeof #
(# $
Startup$ +
)+ ,
., -
Assembly- 5
.5 6
ExportedTypes6 C
.C D
WhereD I
(I J
x 
=> 
typeof 
(  

IInstaller  *
)* +
.+ ,
IsAssignableFrom, <
(< =
x= >
)> ?
&&@ B
!C D
xD E
.E F
IsInterfaceF Q
&&R T
!U V
xV W
.W X

IsAbstractX b
)b c
. 
Select 
( 
	Activator !
.! "
CreateInstance" 0
)0 1
.1 2
Cast2 6
<6 7

IInstaller7 A
>A B
(B C
)C D
.D E
ToListE K
(K L
)L M
;M N

installers 
. 
ForEach 
( 
	installer (
=>) +
	installer, 5
.5 6
InstallServices6 E
(E F
servicesF N
,N O
configurationP ]
)] ^
)^ _
;_ `
} 	
} 
} ≠
FE:\litmanager\litmanager-api\litmanager-api\Installers\JwtInstaller.cs
	namespace 	
litmanager_api
 
. 

Installers #
{ 
public 

class 
JwtInstaller 
: 

IInstaller  *
{ 
public 
void 
InstallServices #
(# $
IServiceCollection$ 6
services7 ?
,? @
IConfigurationA O
ConfigurationP ]
)] ^
{ 	
var 
jwtSettings 
= 
new !
JwtSettings" -
(- .
). /
;/ 0
Configuration 
. 
Bind 
( 
nameof %
(% &
jwtSettings& 1
)1 2
,2 3
jwtSettings4 ?
)? @
;@ A
services 
. 
AddSingleton !
(! "
jwtSettings" -
)- .
;. /
var %
tokenValidationParameters )
=* +
new, /%
TokenValidationParameters0 I
{ $
ValidateIssuerSigningKey (
=) *
true+ /
,/ 0
IssuerSigningKey  
=! "
new# & 
SymmetricSecurityKey' ;
(; <
Encoding< D
.D E
ASCIIE J
.J K
GetBytesK S
(S T
jwtSettingsT _
._ `
Secret` f
)f g
)g h
,h i
ValidateIssuer 
=  
false! &
,& '
ValidateAudience  
=! "
false# (
,( )!
RequireExpirationTime %
=& '
false( -
,- .
ValidateLifetime  
=! "
true# '
} 
; 
services 
. 
AddSingleton !
(! "%
tokenValidationParameters" ;
); <
;< =
services   
.   
AddAuthentication   &
(  & '
x  ' (
=>  ) +
{!! 
x"" 
."" %
DefaultAuthenticateScheme"" +
="", -
JwtBearerDefaults"". ?
.""? @ 
AuthenticationScheme""@ T
;""T U
x## 
.## 
DefaultScheme## 
=##  !
JwtBearerDefaults##" 3
.##3 4 
AuthenticationScheme##4 H
;##H I
x$$ 
.$$ "
DefaultChallengeScheme$$ (
=$$) *
JwtBearerDefaults$$+ <
.$$< = 
AuthenticationScheme$$= Q
;$$Q R
}%% 
)%% 
.&& 
AddJwtBearer&& 
(&& 
x&& 
=>&&  "
{'' 
x(( 
.(( 
	SaveToken(( 
=((  !
true((" &
;((& '
x)) 
.)) %
TokenValidationParameters)) /
=))0 1%
tokenValidationParameters))2 K
;))K L
}** 
)** 
;** 
services,, 
.,, 
AddAuthorization,, %
(,,% &
options,,& -
=>,,. 0
{-- 
options.. 
... 
	AddPolicy.. !
(..! "
$str.." )
,..) *
builder..+ 2
=>..3 5
builder..6 =
...= >
RequireRole..> I
(..I J
$str..J Y
)..Y Z
)..Z [
;..[ \
}// 
)// 
;// 
}11 	
}22 
}33 ø	
GE:\litmanager\litmanager-api\litmanager-api\Installers\MailInstaller.cs
	namespace

 	
litmanager_api


 
.

 

Installers

 #
{ 
public 

class 
MailInstaller 
:  

IInstaller! +
{ 
public 
void 
InstallServices #
(# $
IServiceCollection$ 6
services7 ?
,? @
IConfigurationA O
ConfigurationP ]
)] ^
{ 	
var 
emailConfig 
= 
Configuration +
.+ ,

GetSection, 6
(6 7
$str7 K
)K L
.L M
GetM P
<P Q
EmailConfigurationQ c
>c d
(d e
)e f
;f g
services 
. 
AddSingleton !
(! "
emailConfig" -
)- .
;. /
services 
. 
	AddScoped 
< 
IMailSender *
,* +

MailSender, 6
>6 7
(7 8
)8 9
;9 :
} 	
} 
} Á
JE:\litmanager\litmanager-api\litmanager-api\Installers\ServiceInstaller.cs
	namespace

 	
litmanager_api


 
.

 

Installers

 #
{ 
public 

class 
ServiceInstaller !
:" #

IInstaller$ .
{ 
public 
void 
InstallServices #
(# $
IServiceCollection$ 6
services7 ?
,? @
IConfigurationA O
ConfigurationP ]
)] ^
{ 	
services 
. 
AddCors 
( 
o 
=> !
o" #
.# $
	AddPolicy$ -
(- .
$str. 8
,8 9
builder: A
=>B D
{ 
builder 
. 
AllowAnyOrigin &
(& '
)' (
. 
AllowAnyMethod &
(& '
)' (
. 
AllowAnyHeader &
(& '
)' (
;( )
} 
) 
) 
; 
services 
. 
AddAutoMapper "
(" #
typeof# )
() *
Startup* 1
)1 2
)2 3
;3 4
services 
. 
	AddScoped 
< 
RegistrationService 2
>2 3
(3 4
)4 5
;5 6
services 
. 
	AddScoped 
< 
UserService *
>* +
(+ ,
), -
;- .
services 
. 
	AddScoped 
< 
UserTypeService .
>. /
(/ 0
)0 1
;1 2
services 
. 
	AddScoped 
< 
IdentityService .
>. /
(/ 0
)0 1
;1 2
services 
. 
	AddScoped 
< 
SecurityService .
>. /
(/ 0
)0 1
;1 2
} 	
}   
}!! ≠
JE:\litmanager\litmanager-api\litmanager-api\Installers\SwaggerInstaller.cs
	namespace 	
litmanager_api
 
. 

Installers #
{ 
public 

class 
SwaggerInstaller !
:" #

IInstaller$ .
{ 
public 
void 
InstallServices #
(# $
IServiceCollection$ 6
services7 ?
,? @
IConfigurationA O
ConfigurationP ]
)] ^
{ 	
services 
. 
AddMvc 
( 
option "
=># %
option& ,
., -!
EnableEndpointRouting- B
=C D
falseE J
)J K
. 
AddNewtonsoftJson "
(" #
)# $
. #
SetCompatibilityVersion (
(( ) 
CompatibilityVersion) =
.= >
Version_3_0> I
)I J
;J K
services 
. 
ConfigureSwaggerGen (
(( )
options) 0
=>1 3
{ 
options 
. 
CustomSchemaIds '
(' (
x( )
=>* ,
x- .
.. /
FullName/ 7
)7 8
;8 9
} 
) 
; 
services 
. 
AddSwaggerGen "
(" #
options# *
=>+ -
{ 
options 
. 

SwaggerDoc "
(" #
$str# '
,' (
new) ,
OpenApiInfo- 8
{9 :
Title; @
=A B
$strC P
,P Q
VersionR Y
=Z [
$str\ `
}a b
)b c
;c d
options 
. !
AddSecurityDefinition -
(- .
$str. 6
,6 7
new8 ;!
OpenApiSecurityScheme< Q
{ 
Description   
=    !
$str  " T
,  T U
Name!! 
=!! 
$str!! *
,!!* +
In"" 
="" 
ParameterLocation"" *
.""* +
Header""+ 1
,""1 2
Type## 
=## 
SecuritySchemeType## -
.##- .
ApiKey##. 4
}$$ 
)$$ 
;$$ 
options%% 
.%% "
AddSecurityRequirement%% .
(%%. /
new%%/ 2&
OpenApiSecurityRequirement%%3 M
{&& 
{'' 
new'' !
OpenApiSecurityScheme'' .
{''. /
	Reference''/ 8
=''9 :
new''; >
OpenApiReference''? O
{(( 
Id)) 
=)) 
$str)) %
,))% &
Type** 
=** 
ReferenceType** ,
.**, -
SecurityScheme**- ;
}++ 
}++ 
,++ 
new++ 
List++  
<++  !
string++! '
>++' (
(++( )
)++) *
}++* +
},, 
),, 
;,, 
}-- 
)-- 
;-- 
}.. 	
}// 
}00 î
?E:\litmanager\litmanager-api\litmanager-api\Mail\IMailSender.cs
	namespace 	
litmanager_api
 
. 
Mail 
{ 
public 

	interface 
IMailSender  
{		 
public

 
void

 
SendMail

 
(

 
Receiver

 %
receiver

& .
,

. /
string

0 6
subject

7 >
,

> ?
string

@ F
content

G N
)

N O
;

O P
} 
} À
>E:\litmanager\litmanager-api\litmanager-api\Mail\MailSender.cs
	namespace

 	
litmanager_api


 
.

 
Mail

 
{ 
public 

class 

MailSender 
: 
IMailSender )
{ 
private 
readonly 
EmailConfiguration +
_emailConfiguration, ?
;? @
public 

MailSender 
( 
EmailConfiguration ,
emailConfiguration- ?
)? @
{ 	
_emailConfiguration 
=  !
emailConfiguration" 4
;4 5
} 	
public 
void 
SendMail 
( 
Receiver %
receiver& .
,. /
string0 6
subject7 >
,> ?
string@ F
contentG N
)N O
{ 	
var 
message 
= 
new 
MimeMessage  
(  !
)! "
;" #
message 

.
 
To 
. 
Add 
( 
new 
MailboxAddress $
($ %
receiver% -
.- .
	FirstName. 7
+8 9
$str: =
+> ?
receiver@ H
.H I
LastNameI Q
,Q R
receiverS [
.[ \
Email\ a
)a b
)b c
;c d
message 

.
 
From 
. 
Add 
( 
new 
MailboxAddress &
(& '
$str' 4
,4 5
_emailConfiguration6 I
.I J
FromJ N
)N O
)O P
;P Q
message 

.
 
Subject 
= 
subject 
; 
message 

.
 
Body 
= 
new 
TextPart 
( 

TextFormat )
.) *
Html* .
). /
{ 
Text   
=  	 

content   
}!! 
;!! 
using$$ 
var$$	 
emailClient$$ 
=$$ 
new$$ 

SmtpClient$$ )
($$) *
)$$* +
;$$+ ,
emailClient&& 
.&& 
Connect&& 
(&& 
_emailConfiguration&& *
.&&* +

SmtpServer&&+ 5
,&&5 6
_emailConfiguration&&7 J
.&&J K
Port&&K O
,&&O P
true&&Q U
)&&U V
;&&V W
emailClient)) 
.)) $
AuthenticationMechanisms)) '
.))' (
Remove))( .
()). /
$str))/ 8
)))8 9
;))9 :
emailClient++ 
.++ 
Authenticate++ 
(++ 
_emailConfiguration++ /
.++/ 0
UserName++0 8
,++8 9
_emailConfiguration++: M
.++M N
Password++N V
)++V W
;++W X
emailClient-- 
.-- 
Send-- 
(-- 
message-- 
)-- 
;-- 
emailClient// 
.// 

Disconnect// 
(// 
true// 
)// 
;//  
}00 
}11 
}22 ◊
<E:\litmanager\litmanager-api\litmanager-api\Mail\Receiver.cs
	namespace 	
litmanager_api
 
. 
Mail 
{ 
public 

class 
Receiver 
{		 
public

 
string

 
	FirstName

 
{

  !
get

" %
;

% &
set

' *
;

* +
}

, -
public 
string 
LastName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
} 
} Ë	
JE:\litmanager\litmanager-api\litmanager-api\Mapping\RegistrationMapping.cs
	namespace 	
litmanager_api
 
. 
Mapping  
{ 
public		 

class		 
RegistrationMapping		 $
:		% &
Profile		' .
{

 
public 
RegistrationMapping "
(" #
)# $
{ 	
	CreateMap 
< 
CreateRequest #
,# $
Registration% 1
>1 2
(2 3
)3 4
;4 5
	CreateMap 
< 
UpdateRequest #
,# $
Registration% 1
>1 2
(2 3
)3 4
;4 5
	CreateMap 
< 
CreateRequest #
,# $
GetResponse% 0
>0 1
(1 2
)2 3
;3 4
	CreateMap 
< 
Registration "
," #
GetResponse$ /
>/ 0
(0 1
)1 2
;2 3
	CreateMap 
< 
Registration "
," #
User$ (
>( )
() *
)* +
;+ ,
} 	
} 
} è
BE:\litmanager\litmanager-api\litmanager-api\Mapping\UserMapping.cs
	namespace 	
litmanager_api
 
. 
Mapping  
{ 
public		 

class		 
UserMapping		 
:		 
Profile		 &
{

 
public 
UserMapping 
( 
) 
{ 	
	CreateMap 
< 
CreateRequest #
,# $
User% )
>) *
(* +
)+ ,
;, -
	CreateMap 
< 
UpdateRequest #
,# $
User% )
>) *
(* +
)+ ,
;, -
	CreateMap 
< 
User 
, 
GetResponse '
>' (
(( )
)) *
;* +
	CreateMap 
< 
User 
, 
Receiver $
>$ %
(% &
)& '
;' (
} 	
} 
} é
FE:\litmanager\litmanager-api\litmanager-api\Mapping\UserTypeMapping.cs
	namespace

 	
litmanager_api


 
.

 
Mapping

  
{ 
public 

class 
UserTypeMapping  
:! "
Profile# *
{ 
public 
UserTypeMapping 
( 
)  
{ 	
	CreateMap 
< 
UserType 
, 
GetResponse  +
>+ ,
(, -
)- .
;. /
	CreateMap 
< 
CreateRequest #
,# $
UserType% -
>- .
(. /
)/ 0
;0 1
	CreateMap 
< 
UpdateRequest #
,# $
UserType% -
>- .
(. /
)/ 0
;0 1
} 	
} 
} ¯ó
PE:\litmanager\litmanager-api\litmanager-api\Migrations\20200406011340_initial.cs
	namespace 	
litmanager_api
 
. 

Migrations #
{ 
public 

partial 
class 
initial  
:! "
	Migration# ,
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{		 	
migrationBuilder

 
.

 
CreateTable

 (
(

( )
name 
: 
$str %
,% &
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
Guid& *
>* +
(+ ,
nullable, 4
:4 5
false6 ;
); <
,< =
Type 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
nullable0 8
:8 9
true: >
)> ?
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 7
,7 8
x9 :
=>; =
x> ?
.? @
Id@ B
)B C
;C D
} 
) 
; 
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str !
,! "
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
Guid& *
>* +
(+ ,
nullable, 4
:4 5
false6 ;
); <
,< =
Type 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
nullable0 8
:8 9
true: >
)> ?
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 3
,3 4
x5 6
=>7 9
x: ;
.; <
Id< >
)> ?
;? @
}   
)   
;   
migrationBuilder"" 
."" 
CreateTable"" (
(""( )
name## 
:## 
$str## "
,##" #
columns$$ 
:$$ 
table$$ 
=>$$ !
new$$" %
{%% 
Id&& 
=&& 
table&& 
.&& 
Column&& %
<&&% &
Guid&&& *
>&&* +
(&&+ ,
nullable&&, 4
:&&4 5
false&&6 ;
)&&; <
,&&< =
Name'' 
='' 
table''  
.''  !
Column''! '
<''' (
string''( .
>''. /
(''/ 0
nullable''0 8
:''8 9
true'': >
)''> ?
,''? @
Date(( 
=(( 
table((  
.((  !
Column((! '
<((' (
DateTime((( 0
>((0 1
(((1 2
nullable((2 :
:((: ;
false((< A
)((A B
,((B C
Description)) 
=))  !
table))" '
.))' (
Column))( .
<)). /
string))/ 5
>))5 6
())6 7
nullable))7 ?
:))? @
true))A E
)))E F
,))F G
ActivityTypeId** "
=**# $
table**% *
.*** +
Column**+ 1
<**1 2
Guid**2 6
>**6 7
(**7 8
nullable**8 @
:**@ A
true**B F
)**F G
,**G H
MaxUsers++ 
=++ 
table++ $
.++$ %
Column++% +
<+++ ,
int++, /
>++/ 0
(++0 1
nullable++1 9
:++9 :
false++; @
)++@ A
},, 
,,, 
constraints-- 
:-- 
table-- "
=>--# %
{.. 
table// 
.// 

PrimaryKey// $
(//$ %
$str//% 4
,//4 5
x//6 7
=>//8 :
x//; <
.//< =
Id//= ?
)//? @
;//@ A
table00 
.00 

ForeignKey00 $
(00$ %
name11 
:11 
$str11 J
,11J K
column22 
:22 
x22  !
=>22" $
x22% &
.22& '
ActivityTypeId22' 5
,225 6
principalTable33 &
:33& '
$str33( 7
,337 8
principalColumn44 '
:44' (
$str44) -
,44- .
onDelete55  
:55  !
ReferentialAction55" 3
.553 4
Restrict554 <
)55< =
;55= >
}66 
)66 
;66 
migrationBuilder88 
.88 
CreateTable88 (
(88( )
name99 
:99 
$str99 %
,99% &
columns:: 
::: 
table:: 
=>:: !
new::" %
{;; 
Id<< 
=<< 
table<< 
.<< 
Column<< %
<<<% &
string<<& ,
><<, -
(<<- .
nullable<<. 6
:<<6 7
false<<8 =
)<<= >
,<<> ?
Email== 
=== 
table== !
.==! "
Column==" (
<==( )
string==) /
>==/ 0
(==0 1
nullable==1 9
:==9 :
true==; ?
)==? @
,==@ A
	FirstName>> 
=>> 
table>>  %
.>>% &
Column>>& ,
<>>, -
string>>- 3
>>>3 4
(>>4 5
nullable>>5 =
:>>= >
true>>? C
)>>C D
,>>D E
LastName?? 
=?? 
table?? $
.??$ %
Column??% +
<??+ ,
string??, 2
>??2 3
(??3 4
nullable??4 <
:??< =
true??> B
)??B C
,??C D
PasswordHash@@  
=@@! "
table@@# (
.@@( )
Column@@) /
<@@/ 0
string@@0 6
>@@6 7
(@@7 8
nullable@@8 @
:@@@ A
true@@B F
)@@F G
,@@G H

UserTypeIdAA 
=AA  
tableAA! &
.AA& '
ColumnAA' -
<AA- .
GuidAA. 2
>AA2 3
(AA3 4
nullableAA4 <
:AA< =
trueAA> B
)AAB C
}BB 
,BB 
constraintsCC 
:CC 
tableCC "
=>CC# %
{DD 
tableEE 
.EE 

PrimaryKeyEE $
(EE$ %
$strEE% 7
,EE7 8
xEE9 :
=>EE; =
xEE> ?
.EE? @
IdEE@ B
)EEB C
;EEC D
tableFF 
.FF 

ForeignKeyFF $
(FF$ %
nameGG 
:GG 
$strGG E
,GGE F
columnHH 
:HH 
xHH  !
=>HH" $
xHH% &
.HH& '

UserTypeIdHH' 1
,HH1 2
principalTableII &
:II& '
$strII( 3
,II3 4
principalColumnJJ '
:JJ' (
$strJJ) -
,JJ- .
onDeleteKK  
:KK  !
ReferentialActionKK" 3
.KK3 4
RestrictKK4 <
)KK< =
;KK= >
}LL 
)LL 
;LL 
migrationBuilderNN 
.NN 
CreateTableNN (
(NN( )
nameOO 
:OO 
$strOO 
,OO 
columnsPP 
:PP 
tablePP 
=>PP !
newPP" %
{QQ 
IdRR 
=RR 
tableRR 
.RR 
ColumnRR %
<RR% &
stringRR& ,
>RR, -
(RR- .
nullableRR. 6
:RR6 7
falseRR8 =
)RR= >
,RR> ?
EmailSS 
=SS 
tableSS !
.SS! "
ColumnSS" (
<SS( )
stringSS) /
>SS/ 0
(SS0 1
nullableSS1 9
:SS9 :
trueSS; ?
)SS? @
,SS@ A
	FirstNameTT 
=TT 
tableTT  %
.TT% &
ColumnTT& ,
<TT, -
stringTT- 3
>TT3 4
(TT4 5
nullableTT5 =
:TT= >
trueTT? C
)TTC D
,TTD E
LastNameUU 
=UU 
tableUU $
.UU$ %
ColumnUU% +
<UU+ ,
stringUU, 2
>UU2 3
(UU3 4
nullableUU4 <
:UU< =
trueUU> B
)UUB C
,UUC D
PasswordHashVV  
=VV! "
tableVV# (
.VV( )
ColumnVV) /
<VV/ 0
stringVV0 6
>VV6 7
(VV7 8
nullableVV8 @
:VV@ A
trueVVB F
)VVF G
,VVG H
	IsEnabledWW 
=WW 
tableWW  %
.WW% &
ColumnWW& ,
<WW, -
boolWW- 1
>WW1 2
(WW2 3
nullableWW3 ;
:WW; <
falseWW= B
)WWB C
,WWC D
IsAdminXX 
=XX 
tableXX #
.XX# $
ColumnXX$ *
<XX* +
boolXX+ /
>XX/ 0
(XX0 1
nullableXX1 9
:XX9 :
falseXX; @
)XX@ A
,XXA B

UserTypeIdYY 
=YY  
tableYY! &
.YY& '
ColumnYY' -
<YY- .
GuidYY. 2
>YY2 3
(YY3 4
nullableYY4 <
:YY< =
trueYY> B
)YYB C
}ZZ 
,ZZ 
constraints[[ 
:[[ 
table[[ "
=>[[# %
{\\ 
table]] 
.]] 

PrimaryKey]] $
(]]$ %
$str]]% /
,]]/ 0
x]]1 2
=>]]3 5
x]]6 7
.]]7 8
Id]]8 :
)]]: ;
;]]; <
table^^ 
.^^ 

ForeignKey^^ $
(^^$ %
name__ 
:__ 
$str__ =
,__= >
column`` 
:`` 
x``  !
=>``" $
x``% &
.``& '

UserTypeId``' 1
,``1 2
principalTableaa &
:aa& '
$straa( 3
,aa3 4
principalColumnbb '
:bb' (
$strbb) -
,bb- .
onDeletecc  
:cc  !
ReferentialActioncc" 3
.cc3 4
Restrictcc4 <
)cc< =
;cc= >
}dd 
)dd 
;dd 
migrationBuilderff 
.ff 
CreateTableff (
(ff( )
namegg 
:gg 
$strgg %
,gg% &
columnshh 
:hh 
tablehh 
=>hh !
newhh" %
{ii 
Tokenjj 
=jj 
tablejj !
.jj! "
Columnjj" (
<jj( )
stringjj) /
>jj/ 0
(jj0 1
nullablejj1 9
:jj9 :
falsejj; @
)jj@ A
,jjA B
JwtIdkk 
=kk 
tablekk !
.kk! "
Columnkk" (
<kk( )
stringkk) /
>kk/ 0
(kk0 1
nullablekk1 9
:kk9 :
truekk; ?
)kk? @
,kk@ A
CreationDatell  
=ll! "
tablell# (
.ll( )
Columnll) /
<ll/ 0
DateTimell0 8
>ll8 9
(ll9 :
nullablell: B
:llB C
falsellD I
)llI J
,llJ K

ExpiryDatemm 
=mm  
tablemm! &
.mm& '
Columnmm' -
<mm- .
DateTimemm. 6
>mm6 7
(mm7 8
nullablemm8 @
:mm@ A
falsemmB G
)mmG H
,mmH I
Invalidatednn 
=nn  !
tablenn" '
.nn' (
Columnnn( .
<nn. /
boolnn/ 3
>nn3 4
(nn4 5
nullablenn5 =
:nn= >
falsenn? D
)nnD E
,nnE F
UserIdoo 
=oo 
tableoo "
.oo" #
Columnoo# )
<oo) *
stringoo* 0
>oo0 1
(oo1 2
nullableoo2 :
:oo: ;
trueoo< @
)oo@ A
}pp 
,pp 
constraintsqq 
:qq 
tableqq "
=>qq# %
{rr 
tabless 
.ss 

PrimaryKeyss $
(ss$ %
$strss% 7
,ss7 8
xss9 :
=>ss; =
xss> ?
.ss? @
Tokenss@ E
)ssE F
;ssF G
tablett 
.tt 

ForeignKeytt $
(tt$ %
nameuu 
:uu 
$struu =
,uu= >
columnvv 
:vv 
xvv  !
=>vv" $
xvv% &
.vv& '
UserIdvv' -
,vv- .
principalTableww &
:ww& '
$strww( /
,ww/ 0
principalColumnxx '
:xx' (
$strxx) -
,xx- .
onDeleteyy  
:yy  !
ReferentialActionyy" 3
.yy3 4
Restrictyy4 <
)yy< =
;yy= >
}zz 
)zz 
;zz 
migrationBuilder|| 
.|| 
CreateTable|| (
(||( )
name}} 
:}} 
$str}} $
,}}$ %
columns~~ 
:~~ 
table~~ 
=>~~ !
new~~" %
{ 
UserId
ÄÄ 
=
ÄÄ 
table
ÄÄ "
.
ÄÄ" #
Column
ÄÄ# )
<
ÄÄ) *
string
ÄÄ* 0
>
ÄÄ0 1
(
ÄÄ1 2
nullable
ÄÄ2 :
:
ÄÄ: ;
false
ÄÄ< A
)
ÄÄA B
,
ÄÄB C

ActivityId
ÅÅ 
=
ÅÅ  
table
ÅÅ! &
.
ÅÅ& '
Column
ÅÅ' -
<
ÅÅ- .
Guid
ÅÅ. 2
>
ÅÅ2 3
(
ÅÅ3 4
nullable
ÅÅ4 <
:
ÅÅ< =
false
ÅÅ> C
)
ÅÅC D
}
ÇÇ 
,
ÇÇ 
constraints
ÉÉ 
:
ÉÉ 
table
ÉÉ "
=>
ÉÉ# %
{
ÑÑ 
table
ÖÖ 
.
ÖÖ 

PrimaryKey
ÖÖ $
(
ÖÖ$ %
$str
ÖÖ% 6
,
ÖÖ6 7
x
ÖÖ8 9
=>
ÖÖ: <
new
ÖÖ= @
{
ÖÖA B
x
ÖÖC D
.
ÖÖD E
UserId
ÖÖE K
,
ÖÖK L
x
ÖÖM N
.
ÖÖN O

ActivityId
ÖÖO Y
}
ÖÖZ [
)
ÖÖ[ \
;
ÖÖ\ ]
table
ÜÜ 
.
ÜÜ 

ForeignKey
ÜÜ $
(
ÜÜ$ %
name
áá 
:
áá 
$str
áá E
,
ááE F
column
àà 
:
àà 
x
àà  !
=>
àà" $
x
àà% &
.
àà& '

ActivityId
àà' 1
,
àà1 2
principalTable
ââ &
:
ââ& '
$str
ââ( 4
,
ââ4 5
principalColumn
ää '
:
ää' (
$str
ää) -
,
ää- .
onDelete
ãã  
:
ãã  !
ReferentialAction
ãã" 3
.
ãã3 4
Cascade
ãã4 ;
)
ãã; <
;
ãã< =
table
åå 
.
åå 

ForeignKey
åå $
(
åå$ %
name
çç 
:
çç 
$str
çç <
,
çç< =
column
éé 
:
éé 
x
éé  !
=>
éé" $
x
éé% &
.
éé& '
UserId
éé' -
,
éé- .
principalTable
èè &
:
èè& '
$str
èè( /
,
èè/ 0
principalColumn
êê '
:
êê' (
$str
êê) -
,
êê- .
onDelete
ëë  
:
ëë  !
ReferentialAction
ëë" 3
.
ëë3 4
Cascade
ëë4 ;
)
ëë; <
;
ëë< =
}
íí 
)
íí 
;
íí 
migrationBuilder
îî 
.
îî 
CreateIndex
îî (
(
îî( )
name
ïï 
:
ïï 
$str
ïï 4
,
ïï4 5
table
ññ 
:
ññ 
$str
ññ #
,
ññ# $
column
óó 
:
óó 
$str
óó (
)
óó( )
;
óó) *
migrationBuilder
ôô 
.
ôô 
CreateIndex
ôô (
(
ôô( )
name
öö 
:
öö 
$str
öö /
,
öö/ 0
table
õõ 
:
õõ 
$str
õõ &
,
õõ& '
column
úú 
:
úú 
$str
úú  
)
úú  !
;
úú! "
migrationBuilder
ûû 
.
ûû 
CreateIndex
ûû (
(
ûû( )
name
üü 
:
üü 
$str
üü 3
,
üü3 4
table
†† 
:
†† 
$str
†† &
,
††& '
column
°° 
:
°° 
$str
°° $
)
°°$ %
;
°°% &
migrationBuilder
££ 
.
££ 
CreateIndex
££ (
(
££( )
name
§§ 
:
§§ 
$str
§§ 2
,
§§2 3
table
•• 
:
•• 
$str
•• %
,
••% &
column
¶¶ 
:
¶¶ 
$str
¶¶ $
)
¶¶$ %
;
¶¶% &
migrationBuilder
®® 
.
®® 
CreateIndex
®® (
(
®®( )
name
©© 
:
©© 
$str
©© +
,
©©+ ,
table
™™ 
:
™™ 
$str
™™ 
,
™™ 
column
´´ 
:
´´ 
$str
´´ $
)
´´$ %
;
´´% &
}
¨¨ 	
	protected
ÆÆ 
override
ÆÆ 
void
ÆÆ 
Down
ÆÆ  $
(
ÆÆ$ %
MigrationBuilder
ÆÆ% 5
migrationBuilder
ÆÆ6 F
)
ÆÆF G
{
ØØ 	
migrationBuilder
∞∞ 
.
∞∞ 
	DropTable
∞∞ &
(
∞∞& '
name
±± 
:
±± 
$str
±± %
)
±±% &
;
±±& '
migrationBuilder
≥≥ 
.
≥≥ 
	DropTable
≥≥ &
(
≥≥& '
name
¥¥ 
:
¥¥ 
$str
¥¥ %
)
¥¥% &
;
¥¥& '
migrationBuilder
∂∂ 
.
∂∂ 
	DropTable
∂∂ &
(
∂∂& '
name
∑∑ 
:
∑∑ 
$str
∑∑ $
)
∑∑$ %
;
∑∑% &
migrationBuilder
ππ 
.
ππ 
	DropTable
ππ &
(
ππ& '
name
∫∫ 
:
∫∫ 
$str
∫∫ "
)
∫∫" #
;
∫∫# $
migrationBuilder
ºº 
.
ºº 
	DropTable
ºº &
(
ºº& '
name
ΩΩ 
:
ΩΩ 
$str
ΩΩ 
)
ΩΩ 
;
ΩΩ 
migrationBuilder
øø 
.
øø 
	DropTable
øø &
(
øø& '
name
¿¿ 
:
¿¿ 
$str
¿¿ %
)
¿¿% &
;
¿¿& '
migrationBuilder
¬¬ 
.
¬¬ 
	DropTable
¬¬ &
(
¬¬& '
name
√√ 
:
√√ 
$str
√√ !
)
√√! "
;
√√" #
}
ƒƒ 	
}
≈≈ 
}∆∆ ˘1
ÅE:\litmanager\litmanager-api\litmanager-api\Migrations\20200407122733_Added usertypeid and foreignkey to User and Registration.cs
	namespace 	
litmanager_api
 
. 

Migrations #
{ 
public 

partial 
class =
1AddedusertypeidandforeignkeytoUserandRegistration J
:K L
	MigrationM V
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{		 	
migrationBuilder

 
.

 
DropForeignKey

 +
(

+ ,
name 
: 
$str =
,= >
table 
: 
$str &
)& '
;' (
migrationBuilder 
. 
DropForeignKey +
(+ ,
name 
: 
$str 5
,5 6
table 
: 
$str 
) 
;  
migrationBuilder 
. 
AlterColumn (
<( )
Guid) -
>- .
(. /
name 
: 
$str "
," #
table 
: 
$str 
, 
nullable 
: 
false 
,  

oldClrType 
: 
typeof "
(" #
Guid# '
)' (
,( )
oldType 
: 
$str +
,+ ,
oldNullable 
: 
true !
)! "
;" #
migrationBuilder 
. 
AlterColumn (
<( )
Guid) -
>- .
(. /
name 
: 
$str "
," #
table 
: 
$str &
,& '
nullable 
: 
false 
,  

oldClrType 
: 
typeof "
(" #
Guid# '
)' (
,( )
oldType 
: 
$str +
,+ ,
oldNullable   
:   
true   !
)  ! "
;  " #
migrationBuilder"" 
."" 
AddForeignKey"" *
(""* +
name## 
:## 
$str## =
,##= >
table$$ 
:$$ 
$str$$ &
,$$& '
column%% 
:%% 
$str%% $
,%%$ %
principalTable&& 
:&& 
$str&&  +
,&&+ ,
principalColumn'' 
:''  
$str''! %
,''% &
onDelete(( 
:(( 
ReferentialAction(( +
.((+ ,
Cascade((, 3
)((3 4
;((4 5
migrationBuilder** 
.** 
AddForeignKey** *
(*** +
name++ 
:++ 
$str++ 5
,++5 6
table,, 
:,, 
$str,, 
,,, 
column-- 
:-- 
$str-- $
,--$ %
principalTable.. 
:.. 
$str..  +
,..+ ,
principalColumn// 
://  
$str//! %
,//% &
onDelete00 
:00 
ReferentialAction00 +
.00+ ,
Cascade00, 3
)003 4
;004 5
}11 	
	protected33 
override33 
void33 
Down33  $
(33$ %
MigrationBuilder33% 5
migrationBuilder336 F
)33F G
{44 	
migrationBuilder55 
.55 
DropForeignKey55 +
(55+ ,
name66 
:66 
$str66 =
,66= >
table77 
:77 
$str77 &
)77& '
;77' (
migrationBuilder99 
.99 
DropForeignKey99 +
(99+ ,
name:: 
::: 
$str:: 5
,::5 6
table;; 
:;; 
$str;; 
);; 
;;;  
migrationBuilder== 
.== 
AlterColumn== (
<==( )
Guid==) -
>==- .
(==. /
name>> 
:>> 
$str>> "
,>>" #
table?? 
:?? 
$str?? 
,?? 
type@@ 
:@@ 
$str@@ (
,@@( )
nullableAA 
:AA 
trueAA 
,AA 

oldClrTypeBB 
:BB 
typeofBB "
(BB" #
GuidBB# '
)BB' (
)BB( )
;BB) *
migrationBuilderDD 
.DD 
AlterColumnDD (
<DD( )
GuidDD) -
>DD- .
(DD. /
nameEE 
:EE 
$strEE "
,EE" #
tableFF 
:FF 
$strFF &
,FF& '
typeGG 
:GG 
$strGG (
,GG( )
nullableHH 
:HH 
trueHH 
,HH 

oldClrTypeII 
:II 
typeofII "
(II" #
GuidII# '
)II' (
)II( )
;II) *
migrationBuilderKK 
.KK 
AddForeignKeyKK *
(KK* +
nameLL 
:LL 
$strLL =
,LL= >
tableMM 
:MM 
$strMM &
,MM& '
columnNN 
:NN 
$strNN $
,NN$ %
principalTableOO 
:OO 
$strOO  +
,OO+ ,
principalColumnPP 
:PP  
$strPP! %
,PP% &
onDeleteQQ 
:QQ 
ReferentialActionQQ +
.QQ+ ,
RestrictQQ, 4
)QQ4 5
;QQ5 6
migrationBuilderSS 
.SS 
AddForeignKeySS *
(SS* +
nameTT 
:TT 
$strTT 5
,TT5 6
tableUU 
:UU 
$strUU 
,UU 
columnVV 
:VV 
$strVV $
,VV$ %
principalTableWW 
:WW 
$strWW  +
,WW+ ,
principalColumnXX 
:XX  
$strXX! %
,XX% &
onDeleteYY 
:YY 
ReferentialActionYY +
.YY+ ,
RestrictYY, 4
)YY4 5
;YY5 6
}ZZ 	
}[[ 
}\\ ≠
oE:\litmanager\litmanager-api\litmanager-api\Migrations\20200407162248_removed passwordhash from registration.cs
	namespace 	
litmanager_api
 
. 

Migrations #
{ 
public 

partial 
class /
#removedpasswordhashfromregistration <
:= >
	Migration? H
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder		 
.		 

DropColumn		 '
(		' (
name

 
:

 
$str

 $
,

$ %
table 
: 
$str &
)& '
;' (
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder 
. 
	AddColumn &
<& '
string' -
>- .
(. /
name 
: 
$str $
,$ %
table 
: 
$str &
,& '
type 
: 
$str %
,% &
nullable 
: 
true 
) 
;  
} 	
} 
} ¢
IE:\litmanager\litmanager-api\litmanager-api\Options\EmailConfiguration.cs
	namespace 	
litmanager_api
 
. 
Options  
{ 
public 

class 
EmailConfiguration #
{		 
public

 
string

 
From

 
{

 
get

  
;

  !
set

" %
;

% &
}

' (
public 
string 

SmtpServer  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
int 
Port 
{ 
get 
; 
set "
;" #
}$ %
public 
string 
UserName 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} Œ
BE:\litmanager\litmanager-api\litmanager-api\Options\JwtSettings.cs
	namespace 	
litmanager_api
 
. 
Options  
{ 
public 

class 
JwtSettings 
{		 
public

 
string

 
Secret

 
{

 
get

 "
;

" #
set

$ '
;

' (
}

) *
public 
TimeSpan 
TokenLifetime %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
} 
} Ò
EE:\litmanager\litmanager-api\litmanager-api\Options\SwaggerOptions.cs
	namespace 	
litmanager_api
 
. 
Options  
{ 
public 

class 
SwaggerOptions 
{		 
public

 
string

 
	JsonRoute

 
{

  !
get

" %
;

% &
set

' *
;

* +
}

, -
public 
string 
Description !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
string 

UIEndpoint  
{! "
get# &
;& '
set( +
;+ ,
}- .
} 
} í

6E:\litmanager\litmanager-api\litmanager-api\Program.cs
	namespace

 	
litmanager_api


 
{ 
public 

class 
Program 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{ 	
CreateHostBuilder 
( 
args "
)" #
.# $
Build$ )
() *
)* +
.+ ,
Run, /
(/ 0
)0 1
;1 2
} 	
public 
static 
IHostBuilder "
CreateHostBuilder# 4
(4 5
string5 ;
[; <
]< =
args> B
)B C
=>D F
Host 
.  
CreateDefaultBuilder %
(% &
args& *
)* +
. $
ConfigureWebHostDefaults )
() *

webBuilder* 4
=>5 7
{ 

webBuilder 
. 

UseStartup )
<) *
Startup* 1
>1 2
(2 3
)3 4
;4 5
} 
) 
; 
} 
} ∫|
GE:\litmanager\litmanager-api\litmanager-api\Services\IdentityService.cs
	namespace 	
litmanager_api
 
. 
Services !
{ 
public 

class 
IdentityService  
{ 
private 
readonly 
JwtSettings $
_jwt% )
;) *
private 
readonly 
DataContext $
_context% -
;- .
private 
readonly %
TokenValidationParameters 2&
_tokenValidationParameters3 M
;M N
private 
readonly 
SecurityService (
	_security) 2
;2 3
public 
IdentityService 
( 
JwtSettings *
jwt+ .
,. /
DataContext0 ;
context< C
,C D%
TokenValidationParametersE ^%
tokenValidationParameters_ x
,x y
SecurityService	z â
security
ä í
)
í ì
{ 	
_jwt 
= 
jwt 
; 
_context 
= 
context 
; &
_tokenValidationParameters &
=' (%
tokenValidationParameters) B
;B C
	_security 
= 
security  
;  !
} 	
public 
async 
Task 
< 
AuthResponse &
>& '

LoginAsync( 2
(2 3
User3 7
user8 <
,< =
string> D
passwordE M
)M N
{ 	
if!! 
(!! 
!!! 
	_security!! 
.!! 
VerifyPassword!! )
(!!) *
password!!* 2
,!!2 3
user!!4 8
.!!8 9
PasswordHash!!9 E
)!!E F
)!!F G
{"" 
return## 
new## 
AuthResponse## '
{$$ 
Errors%% 
=%% 
new%%  
[%%  !
]%%! "
{%%# $
$str%%% L
}%%M N
}&& 
;&& 
}'' 
if)) 
()) 
!)) 
user)) 
.)) 
	IsEnabled)) 
)))  
{** 
return++ 
new++ 
AuthResponse++ '
{,, 
Errors-- 
=-- 
new--  
[--  !
]--! "
{--# $
$str--% A
}--B C
}.. 
;.. 
}// 
return00 
await00 
GenerateToken00 &
(00& '
user00' +
)00+ ,
;00, -
}11 	
public33 
async33 
Task33 
<33 
AuthResponse33 &
>33& '
RefreshTokenAsync33( 9
(339 :
string33: @
token33A F
,33F G
string33H N
refreshToken33O [
)33[ \
{44 	
var55 
validatedToken55 
=55  !
GetPrincipalFromToken55! 6
(556 7
token557 <
)55< =
;55= >
if77 
(77 
validatedToken77 
==77 !
null77" &
)77& '
{88 
return99 
new99 
AuthResponse99 '
{:: 
Errors;; 
=;; 
new;;  
[;;  !
];;! "
{;;# $
$str;;% 4
};;5 6
}<< 
;<< 
}== 
var>> 
expiryDateUnix>> 
=>>  
long?? 
.?? 
Parse?? 
(?? 
validatedToken?? )
.??) *
Claims??* 0
.??0 1
Single??1 7
(??7 8
_??8 9
=>??: <
_??= >
.??> ?
Type??? C
==??D F#
JwtRegisteredClaimNames??G ^
.??^ _
Exp??_ b
)??b c
.??c d
Value??d i
)??i j
;??j k
varAA 
expiryDateTimeUtcAA !
=AA" #
newAA$ '
DateTimeAA( 0
(AA0 1
$numAA1 5
,AA5 6
$numAA7 8
,AA8 9
$numAA: ;
,AA; <
$numAA= >
,AA> ?
$numAA@ A
,AAA B
$numAAC D
,AAD E
DateTimeKindAAF R
.AAR S
UtcAAS V
)AAV W
.BB 

AddSecondsBB 
(BB 
expiryDateUnixBB *
)BB* +
.CC 
SubtractCC 
(CC 
_jwtCC 
.CC 
TokenLifetimeCC ,
)CC, -
;CC- .
ifEE 
(EE 
expiryDateTimeUtcEE !
>EE" #
DateTimeEE$ ,
.EE, -
UtcNowEE- 3
)EE3 4
{FF 
returnGG 
newGG 
AuthResponseGG '
{HH 
ErrorsII 
=II 
newII  
[II  !
]II! "
{II# $
$strII% D
}IIE F
}JJ 
;JJ 
}KK 
varMM 
jtiMM 
=MM 
validatedTokenMM $
.MM$ %
ClaimsMM% +
.MM+ ,
SingleMM, 2
(MM2 3
_MM3 4
=>MM5 7
_MM8 9
.MM9 :
TypeMM: >
==MM? A#
JwtRegisteredClaimNamesMMB Y
.MMY Z
JtiMMZ ]
)MM] ^
.MM^ _
ValueMM_ d
;MMd e
varOO 
storedRefreshTokenOO "
=OO# $
awaitOO% *
_contextOO+ 3
.OO3 4
RefreshTokensOO4 A
.OOA B 
SingleOrDefaultAsyncOOB V
(OOV W
_OOW X
=>OOY [
_OO\ ]
.OO] ^
TokenOO^ c
==OOd f
refreshTokenOOg s
)OOs t
;OOt u
ifQQ 
(QQ 
storedRefreshTokenQQ "
==QQ# %
nullQQ& *
)QQ* +
{RR 
returnSS 
newSS 
AuthResponseSS '
{TT 
ErrorsUU 
=UU 
newUU  
[UU  !
]UU! "
{UU# $
$strUU% =
}UU> ?
}VV 
;VV 
}WW 
ifYY 
(YY 
DateTimeYY 
.YY 
UtcNowYY 
>YY  !
storedRefreshTokenYY" 4
.YY4 5

ExpiryDateYY5 ?
)YY? @
{ZZ 
return[[ 
new[[ 
AuthResponse[[ '
{\\ 
Errors]] 
=]] 
new]]  
[]]  !
]]]! "
{]]# $
$str]]% <
}]]= >
}^^ 
;^^ 
}__ 
ifaa 
(aa 
storedRefreshTokenaa "
.aa" #
Invalidatedaa# .
)aa. /
{bb 
returncc 
newcc 
AuthResponsecc '
{dd 
Errorsee 
=ee 
newee  
[ee  !
]ee! "
{ee# $
$stree% N
}eeO P
}ff 
;ff 
}gg 
ifii 
(ii 
storedRefreshTokenii "
.ii" #
JwtIdii# (
!=ii) +
jtiii, /
)ii/ 0
{jj 
returnkk 
newkk 
AuthResponsekk '
{ll 
Errorsmm 
=mm 
newmm  
[mm  !
]mm! "
{mm# $
$strmm% Q
}mmR S
}nn 
;nn 
}oo 
_contextrr 
.rr 
Removerr 
(rr 
storedRefreshTokenrr .
)rr. /
;rr/ 0
awaitss 
_contextss 
.ss 
SaveChangesAsyncss +
(ss+ ,
)ss, -
;ss- .
varuu 
userIduu 
=uu 
validatedTokenuu '
.uu' (
Claimsuu( .
.uu. /
Singleuu/ 5
(uu5 6
_uu6 7
=>uu8 :
_uu; <
.uu< =
Typeuu= A
==uuB D
$struuE I
)uuI J
.uuJ K
ValueuuK P
;uuP Q
varww 
userww 
=ww 
awaitww 
_contextww %
.ww% &
Usersww& +
.ww+ , 
SingleOrDefaultAsyncww, @
(ww@ A
_wwA B
=>wwC E
_wwF G
.wwG H
IdwwH J
==wwK M
userIdwwN T
)wwT U
;wwU V
returnyy 
awaityy 
GenerateTokenyy &
(yy& '
useryy' +
)yy+ ,
;yy, -
}{{ 	
private}} 
ClaimsPrincipal}} !
GetPrincipalFromToken}}  5
(}}5 6
string}}6 <
token}}= B
)}}B C
{~~ 	
var 
tokenHandler 
= 
new "#
JwtSecurityTokenHandler# :
(: ;
); <
;< =
try
ÅÅ 
{
ÇÇ 
var
ÉÉ '
tokenValidationParameters
ÉÉ -
=
ÉÉ. /(
_tokenValidationParameters
ÉÉ0 J
.
ÉÉJ K
Clone
ÉÉK P
(
ÉÉP Q
)
ÉÉQ R
;
ÉÉR S'
tokenValidationParameters
ÑÑ )
.
ÑÑ) *
ValidateLifetime
ÑÑ* :
=
ÑÑ; <
false
ÑÑ= B
;
ÑÑB C
var
ÖÖ 
	principal
ÖÖ 
=
ÖÖ 
tokenHandler
ÖÖ  ,
.
ÖÖ, -
ValidateToken
ÖÖ- :
(
ÖÖ: ;
token
ÖÖ; @
,
ÖÖ@ A'
tokenValidationParameters
ÖÖB [
,
ÖÖ[ \
out
ÖÖ] `
var
ÖÖa d
validatedToken
ÖÖe s
)
ÖÖs t
;
ÖÖt u
if
ÜÜ 
(
ÜÜ 
!
ÜÜ '
IsJwtWithValidSecurityAlg
ÜÜ .
(
ÜÜ. /
validatedToken
ÜÜ/ =
)
ÜÜ= >
)
ÜÜ> ?
{
áá 
return
àà 
null
àà 
;
àà  
}
ââ 
return
ãã 
	principal
ãã  
;
ãã  !
}
åå 
catch
çç 
{
éé 
return
èè 
null
èè 
;
èè 
}
êê 
}
ëë 	
private
ìì 
bool
ìì '
IsJwtWithValidSecurityAlg
ìì .
(
ìì. /
SecurityToken
ìì/ <
validatedToken
ìì= K
)
ììK L
{
îî 	
return
ïï 
(
ïï 
validatedToken
ïï "
is
ïï# %
JwtSecurityToken
ïï& 6
jwtSecurityToken
ïï7 G
)
ïïG H
&&
ïïI K
jwtSecurityToken
ññ  
.
ññ  !
Header
ññ! '
.
ññ' (
Alg
ññ( +
.
ññ+ ,
Equals
ññ, 2
(
ññ2 3 
SecurityAlgorithms
ññ3 E
.
ññE F

HmacSha256
ññF P
,
ññP Q
StringComparison
óó  
.
óó  !(
InvariantCultureIgnoreCase
óó! ;
)
óó; <
;
óó< =
}
òò 	
private
öö 
async
öö 
Task
öö 
<
öö 
AuthResponse
öö '
>
öö' (
GenerateToken
öö) 6
(
öö6 7
User
öö7 ;
user
öö< @
)
öö@ A
{
õõ 	
var
úú 
tokenHandler
úú 
=
úú 
new
úú "%
JwtSecurityTokenHandler
úú# :
(
úú: ;
)
úú; <
;
úú< =
var
ùù 
key
ùù 
=
ùù 
Encoding
ùù 
.
ùù 
ASCII
ùù $
.
ùù$ %
GetBytes
ùù% -
(
ùù- .
_jwt
ùù. 2
.
ùù2 3
Secret
ùù3 9
)
ùù9 :
;
ùù: ;
var
ûû 
tokenDescriptor
ûû 
=
ûû  !
new
ûû" %%
SecurityTokenDescriptor
ûû& =
{
üü 
Subject
†† 
=
†† 
new
†† 
ClaimsIdentity
†† ,
(
††, -
new
††- 0
[
††0 1
]
††1 2
{
°° 
new
¢¢ 
Claim
¢¢ 
(
¢¢ %
JwtRegisteredClaimNames
¢¢ 5
.
¢¢5 6
Sub
¢¢6 9
,
¢¢9 :
user
¢¢; ?
.
¢¢? @
Email
¢¢@ E
)
¢¢E F
,
¢¢F G
new
££ 
Claim
££ 
(
££ %
JwtRegisteredClaimNames
££ 5
.
££5 6
Jti
££6 9
,
££9 :
Guid
££; ?
.
££? @
NewGuid
££@ G
(
££G H
)
££H I
.
££I J
ToString
££J R
(
££R S
)
££S T
)
££T U
,
££U V
new
§§ 
Claim
§§ 
(
§§ %
JwtRegisteredClaimNames
§§ 5
.
§§5 6
Email
§§6 ;
,
§§; <
user
§§= A
.
§§A B
Email
§§B G
)
§§G H
,
§§H I
new
•• 
Claim
•• 
(
•• 
$str
•• "
,
••" #
user
••$ (
.
••( )
Id
••) +
.
••+ ,
ToString
••, 4
(
••4 5
)
••5 6
)
••6 7
,
••7 8
new
¶¶ 
Claim
¶¶ 
(
¶¶ 
$str
¶¶ (
,
¶¶( )
user
¶¶* .
.
¶¶. /
UserType
¶¶/ 7
.
¶¶7 8
Type
¶¶8 <
)
¶¶= >
,
¶¶> ?
new
ßß 
Claim
ßß 
(
ßß 
$str
ßß '
,
ßß' (
user
ßß) -
.
ßß- .
IsAdmin
ßß. 5
.
ßß5 6
ToString
ßß6 >
(
ßß> ?
)
ßß? @
)
ßß@ A
}
®® 
)
®® 
,
®® 
Expires
©© 
=
©© 
DateTime
©© "
.
©©" #
UtcNow
©©# )
.
©©) *
Add
©©* -
(
©©- .
_jwt
©©. 2
.
©©2 3
TokenLifetime
©©3 @
)
©©@ A
,
©©A B 
SigningCredentials
™™ "
=
™™# $
new
´´  
SigningCredentials
´´ *
(
´´* +
new
´´+ ."
SymmetricSecurityKey
´´/ C
(
´´C D
key
´´D G
)
´´G H
,
´´H I 
SecurityAlgorithms
´´J \
.
´´\ ]!
HmacSha256Signature
´´] p
)
´´p q
}
¨¨ 
;
¨¨ 
var
ÆÆ 
token
ÆÆ 
=
ÆÆ 
tokenHandler
ÆÆ $
.
ÆÆ$ %
CreateToken
ÆÆ% 0
(
ÆÆ0 1
tokenDescriptor
ÆÆ1 @
)
ÆÆ@ A
;
ÆÆA B
var
∞∞ 
refreshToken
∞∞ 
=
∞∞ 
new
∞∞ "
RefreshToken
∞∞# /
{
±± 
JwtId
≤≤ 
=
≤≤ 
token
≤≤ 
.
≤≤ 
Id
≤≤  
,
≤≤  !
UserId
≥≥ 
=
≥≥ 
user
≥≥ 
.
≥≥ 
Id
≥≥  
,
≥≥  !
CreationDate
¥¥ 
=
¥¥ 
DateTime
¥¥ '
.
¥¥' (
UtcNow
¥¥( .
,
¥¥. /

ExpiryDate
µµ 
=
µµ 
DateTime
µµ %
.
µµ% &
UtcNow
µµ& ,
.
µµ, -
	AddMonths
µµ- 6
(
µµ6 7
$num
µµ7 8
)
µµ8 9
}
∂∂ 
;
∂∂ 
_context
∏∏ 
.
∏∏ 
RefreshTokens
∏∏ "
.
∏∏" #
Add
∏∏# &
(
∏∏& '
refreshToken
∏∏' 3
)
∏∏3 4
;
∏∏4 5
await
ππ 
_context
ππ 
.
ππ 
SaveChangesAsync
ππ +
(
ππ+ ,
)
ππ, -
;
ππ- .
return
ªª 
new
ªª 
AuthResponse
ªª #
{
ºº 
	IsSuccess
ΩΩ 
=
ΩΩ 
true
ΩΩ  
,
ΩΩ  !
Token
ææ 
=
ææ 
tokenHandler
ææ $
.
ææ$ %

WriteToken
ææ% /
(
ææ/ 0
token
ææ0 5
)
ææ5 6
,
ææ6 7
RefreshToken
øø 
=
øø 
refreshToken
øø +
.
øø+ ,
Token
øø, 1
}
¿¿ 
;
¿¿ 
}
¡¡ 	
}
≈≈ 
}∆∆ ‚

@E:\litmanager\litmanager-api\litmanager-api\Services\IService.cs
	namespace 	
litmanager_api
 
. 
Services !
{		 
public

 

	interface

 
IService

 
<

 
TPost

 #
,

# $
TGet

$ (
,

( )
TId

* -
>

- .
{ 
public 
Task 
< 
bool 
> 
AddAsync "
(" #
TPost# (
objectToCreate) 7
)7 8
;8 9
public 
Task 
< 
TGet 
> 
GetAsync "
(" #
TId# &
idToGet' .
). /
;/ 0
public 
Task 
< 
List 
< 
TGet 
> 
> 
GetAllAsync  +
(+ ,
), -
;- .
public 
Task 
< 
bool 
> 
DeleteAsync %
(% &
TId& )
idToGet* 1
)1 2
;2 3
public 
Task 
< 
bool 
> 
UpdateAsync %
(% &
TGet& *
objectToUpdate+ 9
)9 :
;: ;
} 
} ˇ,
KE:\litmanager\litmanager-api\litmanager-api\Services\RegistrationService.cs
	namespace 	
litmanager_api
 
. 
Services !
{ 
public 

class 
RegistrationService $
:% &
IService' /
</ 0
CreateRequest0 =
,= >
Registration> J
,J K
stringL R
>R S
{ 
private 
readonly 
DataContext $
_context% -
;- .
private 
readonly 
IMapper  
_mapper! (
;( )
public 
RegistrationService "
(" #
DataContext# .
context/ 6
,6 7
IMapper8 ?
mapper@ F
)F G
{ 	
_context 
= 
context 
; 
_mapper 
= 
mapper 
; 
} 	
public 
async 
Task 
< 
bool 
> 
AddAsync  (
(( )
CreateRequest) 6
objectToCreate7 E
)E F
{ 	
if 
( 
await 
_context 
. 
Registrations +
.+ ,
AnyAsync, 4
(4 5
_5 6
=>6 8
_8 9
.9 :
Id: <
=== ?
objectToCreate@ N
.N O
IdO Q
||R T
_U V
.V W
EmailW \
==] _
objectToCreate` n
.n o
Emailo t
)t u
)u v
{ 
return 
false 
; 
} 
var!! 
registration!! 
=!! 
_mapper!! &
.!!& '
Map!!' *
<!!* +
Registration!!+ 7
>!!7 8
(!!8 9
objectToCreate!!9 G
)!!G H
;!!H I
registration$$ 
.$$ 
Email$$ 
=$$  
registration$$! -
.$$- .
Email$$. 3
.$$3 4
ToUpper$$4 ;
($$; <
)$$< =
;$$= >
_context&& 
.&& 
Registrations&& "
.&&" #
Add&&# &
(&&& '
registration&&' 3
)&&3 4
;&&4 5
var)) 
created)) 
=)) 
await)) 
_context))  (
.))( )
SaveChangesAsync))) 9
())9 :
))): ;
;)); <
return** 
created** 
>** 
$num** 
;** 
}++ 	
public-- 
async-- 
Task-- 
<-- 
List-- 
<-- 
Registration-- +
>--+ ,
>--, -
GetAllAsync--. 9
(--9 :
)--: ;
{.. 	
return00 
await00 
_context00 !
.00! "
Registrations00" /
.00/ 0
Include000 7
(007 8
_008 9
=>00: <
_00= >
.00> ?
UserType00? G
)00G H
.00H I
ToListAsync00I T
(00T U
)00U V
;00V W
}11 	
public33 
async33 
Task33 
<33 
Registration33 &
>33& '
GetAsync33( 0
(330 1
string331 7
idToGet338 ?
)33? @
{44 	
return66 
await66 
_context66 !
.66! "
Registrations66" /
.66/ 0
Include660 7
(667 8
_668 9
=>669 ;
_66; <
.66< =
UserType66= E
)66E F
.66F G 
SingleOrDefaultAsync66G [
(66[ \
_66\ ]
=>66^ `
_66a b
.66b c
Id66c e
==66f h
idToGet66i p
)66p q
;66q r
}77 	
public88 
async88 
Task88 
<88 
bool88 
>88 
UpdateAsync88  +
(88+ ,
Registration88, 8
objectToUpdate889 G
)88G H
{99 	
_context;; 
.;; 
Registrations;; "
.;;" #
Update;;# )
(;;) *
objectToUpdate;;* 8
);;8 9
;;;9 :
var<< 
updated<< 
=<< 
await<< 
_context<<  (
.<<( )
SaveChangesAsync<<) 9
(<<9 :
)<<: ;
;<<; <
return== 
updated== 
>== 
$num== 
;== 
}>> 	
public@@ 
async@@ 
Task@@ 
<@@ 
bool@@ 
>@@ 
DeleteAsync@@  +
(@@+ ,
string@@, 2
idToGet@@3 :
)@@: ;
{AA 	
varCC  
registrationToDeleteCC $
=CC% &
awaitCC' ,
GetAsyncCC- 5
(CC5 6
idToGetCC6 =
)CC= >
;CC> ?
ifDD 
(DD  
registrationToDeleteDD $
==DD% '
nullDD( ,
)DD, -
{EE 
returnFF 
falseFF 
;FF 
}GG 
_contextII 
.II 
RegistrationsII "
.II" #
RemoveII# )
(II) * 
registrationToDeleteII* >
)II> ?
;II? @
varJJ 
removedJJ 
=JJ 
awaitJJ 
_contextJJ  (
.JJ( )
SaveChangesAsyncJJ) 9
(JJ9 :
)JJ: ;
;JJ; <
returnMM 
removedMM 
>MM 
$numMM 
;MM 
}NN 	
}OO 
}PP ó	
GE:\litmanager\litmanager-api\litmanager-api\Services\SecurityService.cs
	namespace 	
litmanager_api
 
. 
Services !
{ 
public		 

class		 
SecurityService		  
{

 
public 
string 
HashPassword "
(" #
string# )
password* 2
)2 3
{ 	
return 
BCrypt 
. 
Net 
. 
BCrypt $
.$ % 
EnhancedHashPassword% 9
(9 :
password: B
)B C
;C D
} 	
public 
bool 
VerifyPassword "
(" #
string# )
inputPassword* 7
,7 8
string9 ?
storedPassword@ N
)N O
{ 	
return 
BCrypt 
. 
Net 
. 
BCrypt $
.$ %
EnhancedVerify% 3
(3 4
inputPassword4 A
,A B
storedPasswordC Q
)Q R
;R S
} 	
} 
} Á<
CE:\litmanager\litmanager-api\litmanager-api\Services\UserService.cs
	namespace 	
litmanager_api
 
. 
Services !
{ 
public 

class 
UserService 
: 
IService '
<' (
User( ,
,, -
User. 2
,2 3
string4 :
>: ;
{ 
private 
readonly 
DataContext $
_context% -
;- .
private 
readonly 
SecurityService (
	_security) 2
;2 3
public 
UserService 
( 
DataContext &
context' .
,. /
SecurityService0 ?
security@ H
)H I
{ 	
_context 
= 
context 
; 
	_security 
= 
security  
;  !
} 	
public 
async 
Task 
< 
bool 
> 
AddAsync  (
(( )
User) -
objectToCreate. <
)< =
{ 	
if 
( 
await 

UserExists 
(  
objectToCreate  .
.. /
Id/ 1
,1 2
objectToCreate3 A
.A B
EmailB G
)G H
)H I
{ 
return 
false 
; 
} 
_context 
. 
Users 
. 
Add 
( 
objectToCreate -
)- .
;. /
var!! 
created!! 
=!! 
await!! 
_context!!  (
.!!( )
SaveChangesAsync!!) 9
(!!9 :
)!!: ;
;!!; <
return"" 
created"" 
>"" 
$num"" 
;"" 
}## 	
public%% 
async%% 
Task%% 
<%% 
User%% 
>%% 
GetAsync%%  (
(%%( )
string%%) /
idToGet%%0 7
)%%7 8
{&& 	
return(( 
await(( 
_context(( !
.((! "
Users((" '
.((' (
Include((( /
(((/ 0
_((0 1
=>((1 3
_((3 4
.((4 5
UserType((5 =
)((= >
.((> ? 
SingleOrDefaultAsync((? S
(((S T
_((T U
=>((V X
_((Y Z
.((Z [
Id(([ ]
==((^ `
idToGet((a h
)((h i
;((i j
})) 	
public++ 
async++ 
Task++ 
<++ 
List++ 
<++ 
User++ #
>++# $
>++$ %
GetAllAsync++& 1
(++1 2
)++2 3
{,, 	
return.. 
await.. 
_context.. !
...! "
Users.." '
...' (
Include..( /
(../ 0
_..0 1
=>..2 4
_..5 6
...6 7
UserType..7 ?
)..? @
...@ A
ToListAsync..A L
(..L M
)..M N
;..N O
}// 	
public00 
async00 
Task00 
<00 
bool00 
>00 
UpdateAsync00  +
(00+ ,
User00, 0
objectToUpdate001 ?
)00? @
{11 	
_context22 
.22 
Update22 
(22 
objectToUpdate22 *
)22* +
;22+ ,
var44 
updated44 
=44 
await44 
_context44  (
.44( )
SaveChangesAsync44) 9
(449 :
)44: ;
;44; <
return55 
updated55 
>55 
$num55 
;55 
}66 	
public77 
async77 
Task77 
<77 
bool77 
>77 
DeleteAsync77  +
(77+ ,
string77, 2
idToGet773 :
)77: ;
{88 	
var:: 
userToDelete:: 
=:: 
await:: $
GetAsync::% -
(::- .
idToGet::. 5
)::5 6
;::6 7
if;; 
(;; 
userToDelete;; 
==;; 
null;;  $
);;$ %
{<< 
return== 
false== 
;== 
}>> 
_context@@ 
.@@ 
Users@@ 
.@@ 
Remove@@ !
(@@! "
userToDelete@@" .
)@@. /
;@@/ 0
varAA 
removedAA 
=AA 
awaitAA 
_contextAA  (
.AA( )
SaveChangesAsyncAA) 9
(AA9 :
)AA: ;
;AA; <
returnDD 
removedDD 
>DD 
$numDD 
;DD 
}EE 	
publicGG 
asyncGG 
TaskGG 
<GG 
boolGG 
>GG 
ChangePasswordAsyncGG  3
(GG3 4
stringGG4 :
userIdGG; A
,GGA B
stringGGC I
passwordGGJ R
)GGR S
{HH 	
varII 
userToUpdateII 
=II 
awaitII $
GetAsyncII% -
(II- .
userIdII. 4
)II4 5
;II5 6
ifJJ 
(JJ 
userToUpdateJJ 
==JJ 
nullJJ  $
)JJ$ %
{KK 
returnLL 
falseLL 
;LL 
}MM 
userToUpdateOO 
.OO 
PasswordHashOO %
=OO& '
	_securityOO( 1
.OO1 2
HashPasswordOO2 >
(OO> ?
passwordOO? G
)OOG H
;OOH I
_contextRR 
.RR 
UsersRR 
.RR 
UpdateRR !
(RR! "
userToUpdateRR" .
)RR. /
;RR/ 0
varSS 
updatedSS 
=SS 
awaitSS 
_contextSS  (
.SS( )
SaveChangesAsyncSS) 9
(SS9 :
)SS: ;
;SS; <
returnVV 
updatedVV 
>VV 
$numVV 
;VV 
}WW 	
publicYY 
asyncYY 
TaskYY 
<YY 
UserYY 
>YY 
GetByEmailAsyncYY  /
(YY/ 0
stringYY0 6
emailYY7 <
)YY< =
{ZZ 	
return\\ 
await\\ 
_context\\ !
.\\! "
Users\\" '
.\\' (
Include\\( /
(\\/ 0
_\\0 1
=>\\2 4
_\\5 6
.\\6 7
UserType\\7 ?
)\\? @
.\\@ A 
SingleOrDefaultAsync\\A U
(\\U V
_\\V W
=>\\X Z
_\\[ \
.\\\ ]
Email\\] b
==\\c e
email\\f k
.\\k l
ToUpper\\l s
(\\s t
)\\t u
)\\u v
;\\v w
}]] 	
public__ 
async__ 
Task__ 
<__ 
bool__ 
>__ 

UserExists__  *
(__* +
string__+ 1
id__2 4
,__4 5
string__6 <
email__= B
)__B C
{`` 	
ifaa 
(aa 
awaitaa 
_contextaa 
.aa 
Usersaa $
.aa$ %
AnyAsyncaa% -
(aa- .
_aa. /
=>aa0 2
_aa3 4
.aa4 5
Idaa5 7
==aa8 :
idaa; =
||aa> @
_aaA B
.aaB C
EmailaaC H
==aaI K
emailaaL Q
)aaQ R
)aaR S
{bb 
returncc 
truecc 
;cc 
}dd 
returnee 
falseee 
;ee 
}ff 	
}gg 
}hh „&
GE:\litmanager\litmanager-api\litmanager-api\Services\UserTypeService.cs
	namespace		 	
litmanager_api		
 
.		 
Services		 !
{

 
public 

class 
UserTypeService  
:! "
IService# +
<+ ,
UserType, 4
,4 5
UserType6 >
,> ?
Guid@ D
>D E
{ 
private 
readonly 
DataContext $
_context% -
;- .
public 
UserTypeService 
( 
DataContext *
context+ 2
)2 3
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
bool 
> 
AddAsync  (
(( )
UserType) 1
objectToCreate2 @
)@ A
{ 	
if 
( 
await 
_context 
. 
	UserTypes (
.( )
AnyAsync) 1
(1 2
_2 3
=>4 6
_7 8
.8 9
Type9 =
==> @
objectToCreateA O
.O P
TypeP T
)T U
)U V
{ 
return 
false 
; 
} 
_context 
. 
	UserTypes 
. 
Add "
(" #
objectToCreate# 1
)1 2
;2 3
var 
created 
= 
await 
_context  (
.( )
SaveChangesAsync) 9
(9 :
): ;
;; <
return 
created 
> 
$num 
; 
} 	
public!! 
async!! 
Task!! 
<!! 
List!! 
<!! 
UserType!! '
>!!' (
>!!( )
GetAllAsync!!* 5
(!!5 6
)!!6 7
{"" 	
return$$ 
await$$ 
_context$$ !
.$$! "
	UserTypes$$" +
.$$+ ,
ToListAsync$$, 7
($$7 8
)$$8 9
;$$9 :
}%% 	
public'' 
async'' 
Task'' 
<'' 
UserType'' "
>''" #
GetAsync''$ ,
('', -
Guid''- 1
idToGet''2 9
)''9 :
{(( 	
return** 
await** 
_context** !
.**! "
	UserTypes**" +
.**+ , 
SingleOrDefaultAsync**, @
(**@ A
_**A B
=>**C E
_**F G
.**G H
Id**H J
==**K M
idToGet**N U
)**U V
;**V W
}++ 	
public-- 
async-- 
Task-- 
<-- 
bool-- 
>-- 
UpdateAsync--  +
(--+ ,
UserType--, 4
objectToUpdate--5 C
)--C D
{.. 	
_context00 
.00 
	UserTypes00 
.00 
Update00 %
(00% &
objectToUpdate00& 4
)004 5
;005 6
var11 
updated11 
=11 
await11 
_context11  (
.11( )
SaveChangesAsync11) 9
(119 :
)11: ;
;11; <
return44 
updated44 
>44 
$num44 
;44 
}55 	
public77 
async77 
Task77 
<77 
bool77 
>77 
DeleteAsync77  +
(77+ ,
Guid77, 0
idToGet771 8
)778 9
{88 	
var:: 
userTypeToDelete::  
=::! "
await::# (
GetAsync::) 1
(::1 2
idToGet::2 9
)::9 :
;::: ;
if;; 
(;; 
userTypeToDelete;;  
==;;! #
null;;$ (
);;( )
{<< 
return== 
false== 
;== 
}>> 
_context@@ 
.@@ 
	UserTypes@@ 
.@@ 
Remove@@ %
(@@% &
userTypeToDelete@@& 6
)@@6 7
;@@7 8
varAA 
removedAA 
=AA 
awaitAA 
_contextAA  (
.AA( )
SaveChangesAsyncAA) 9
(AA9 :
)AA: ;
;AA; <
returnDD 
removedDD 
>DD 
$numDD 
;DD 
}EE 	
publicGG 
TaskGG 
<GG 
boolGG 
>GG 

PatchAsyncGG $
(GG$ %
GuidGG% )
	idToPatchGG* 3
,GG3 4
JsonPatchDocumentGG5 F
patchDocumentGGG T
)GGT U
{HH 	
throwII 
newII #
NotImplementedExceptionII -
(II- .
)II. /
;II/ 0
}JJ 	
}KK 
}LL æ$
6E:\litmanager\litmanager-api\litmanager-api\Startup.cs
	namespace 	
litmanager_api
 
{ 
public 

class 
Startup 
{ 
public 
Startup 
( 
IConfiguration %
configuration& 3
)3 4
{ 	
Configuration 
= 
configuration )
;) *
} 	
public 
IConfiguration 
Configuration +
{, -
get. 1
;1 2
}3 4
public 
void 
ConfigureServices %
(% &
IServiceCollection& 8
services9 A
)A B
{ 	
services 
. %
InstallServicesInAssembly .
(. /
Configuration/ <
)< =
;= >
} 	
private   
static   -
!NewtonsoftJsonPatchInputFormatter   8&
GetJsonPatchInputFormatter  9 S
(  S T
)  T U
{!! 	
var"" 
builder"" 
="" 
new"" 
ServiceCollection"" /
(""/ 0
)""0 1
.## 

AddLogging## 
(## 
)## 
.$$ 
AddMvc$$ 
($$ 
)$$ 
.%% 
AddNewtonsoftJson%% "
(%%" #
)%%# $
.&& 
Services&& 
.&&  
BuildServiceProvider&& .
(&&. /
)&&/ 0
;&&0 1
return(( 
builder(( 
.)) 
GetRequiredService)) #
<))# $
IOptions))$ ,
<)), -

MvcOptions))- 7
>))7 8
>))8 9
())9 :
))): ;
.** 
Value** 
.++ 
InputFormatters++  
.,, 
OfType,, 
<,, -
!NewtonsoftJsonPatchInputFormatter,, 9
>,,9 :
(,,: ;
),,; <
.-- 
First-- 
(-- 
)-- 
;-- 
}.. 	
public11 
void11 
	Configure11 
(11 
IApplicationBuilder11 1
app112 5
,115 6
IWebHostEnvironment117 J
env11K N
)11N O
{22 	
if33 
(33 
env33 
.33 
IsDevelopment33 !
(33! "
)33" #
)33# $
{44 
app55 
.55 %
UseDeveloperExceptionPage55 -
(55- .
)55. /
;55/ 0
}66 
else77 
{88 
app99 
.99 
UseHsts99 
(99 
)99 
;99 
}:: 
app<< 
.<< 
UseCors<< 
(<< 
$str<< "
)<<" #
;<<# $
var>> 
swaggerOptions>> 
=>>  
new>>! $
SwaggerOptions>>% 3
(>>3 4
)>>4 5
;>>5 6
Configuration?? 
.?? 

GetSection?? $
(??$ %
nameof??% +
(??+ ,
SwaggerOptions??, :
)??: ;
)??; <
.??< =
Bind??= A
(??A B
swaggerOptions??B P
)??P Q
;??Q R
appAA 
.AA 

UseSwaggerAA 
(AA 
optionAA !
=>AA" $
{AA% &
optionAA' -
.AA- .
RouteTemplateAA. ;
=AA< =
swaggerOptionsAA> L
.AAL M
	JsonRouteAAM V
;AAV W
}AAX Y
)AAY Z
;AAZ [
appBB 
.BB 
UseSwaggerUIBB 
(BB 
optionBB #
=>BB$ &
{CC 
optionDD 
.DD 
SwaggerEndpointDD &
(DD& '
swaggerOptionsDD' 5
.DD5 6

UIEndpointDD6 @
,DD@ A
swaggerOptionsDDB P
.DDP Q
DescriptionDDQ \
)DD\ ]
;DD] ^
}EE 
)EE 
;EE 
appGG 
.GG 
UseStaticFilesGG 
(GG 
)GG  
;GG  !
appII 
.II 

UseRoutingII 
(II 
)II 
;II 
appKK 
.KK 
UseAuthorizationKK  
(KK  !
)KK! "
;KK" #
appMM 
.MM 
UseEndpointsMM 
(MM 
	endpointsMM &
=>MM' )
{NN 
	endpointsOO 
.OO 
MapControllersOO (
(OO( )
)OO) *
;OO* +
}PP 
)PP 
;PP 
}QQ 	
}RR 
}SS 